"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/auth";
exports.ids = ["pages/api/auth"];
exports.modules = {

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "sqlite":
/*!*************************!*\
  !*** external "sqlite" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("sqlite");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_auth_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/auth.ts */ \"(api)/./pages/api/auth.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_auth_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/auth\",\n        pathname: \"/api/auth\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_auth_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmF1dGgmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRmF1dGgudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDZ0Q7QUFDaEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aXRlLXJlYWN0LXR5cGVzY3JpcHQtc3RhcnRlci8/Yjc2NiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2F1dGgudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hdXRoXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYXV0aFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/auth.ts":
/*!***************************!*\
  !*** ./pages/api/auth.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _src_lib_db__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/lib/db */ \"(api)/./src/lib/db.ts\");\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-secret-key\";\n// Initialize DB flag\nlet dbInitialized = false;\nconst failedLoginAttempts = {};\nconst blockedIPs = {}; // Stores IP -> blockedUntil timestamp\nconst MAX_FAILED_ATTEMPTS = 3;\nconst BLOCK_DURATION_MS = 15 * 60 * 1000; // 15 minutes\nconst ATTEMPT_WINDOW_MS = 5 * 60 * 1000; // Reset attempts if no new attempt in 5 mins\nfunction getClientIp(req) {\n    const xForwardedFor = req.headers[\"x-forwarded-for\"];\n    if (typeof xForwardedFor === \"string\") {\n        return xForwardedFor.split(\",\")[0].trim();\n    }\n    const xRealIp = req.headers[\"x-real-ip\"];\n    if (typeof xRealIp === \"string\") {\n        return xRealIp.trim();\n    }\n    return req.socket.remoteAddress || \"unknown\";\n}\nasync function handler(req, res) {\n    // Set proper JSON content type\n    res.setHeader(\"Content-Type\", \"application/json\");\n    // Handle preflight OPTIONS request for CORS\n    if (req.method === \"OPTIONS\") {\n        return res.status(200).end();\n    }\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            message: \"Method not allowed\"\n        });\n    }\n    const clientIp = getClientIp(req);\n    // Check if IP is blocked\n    if (blockedIPs[clientIp] && blockedIPs[clientIp] > Date.now()) {\n        const timeLeft = Math.ceil((blockedIPs[clientIp] - Date.now()) / 1000 / 60);\n        return res.status(429).json({\n            message: `Too many failed login attempts. Please try again in ${timeLeft} minutes.`\n        });\n    } else if (blockedIPs[clientIp] && blockedIPs[clientIp] <= Date.now()) {\n        delete blockedIPs[clientIp]; // Unblock if time has passed\n        delete failedLoginAttempts[clientIp]; // Also clear attempts\n    }\n    try {\n        // Initialize database if not already done\n        if (!dbInitialized) {\n            try {\n                await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_2__.initializeDB)();\n                dbInitialized = true;\n                console.log(\"DB initialized in auth API\");\n            } catch (dbError) {\n                console.error(\"Failed to initialize database:\", dbError);\n                return res.status(500).json({\n                    message: \"Database initialization failed\",\n                    error: dbError instanceof Error ? dbError.message : String(dbError)\n                });\n            }\n        }\n        const { username, password } = req.body;\n        if (!username || !password) {\n            return res.status(400).json({\n                message: \"Username and password are required\"\n            });\n        }\n        const db = await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_2__.getDB)();\n        const user = await db.get(\"SELECT * FROM users WHERE username = ?\", [\n            username\n        ]);\n        if (!user) {\n            // Generic message for non-existent user or wrong password to prevent username enumeration\n            // Increment failed attempts\n            failedLoginAttempts[clientIp] = failedLoginAttempts[clientIp] || {\n                count: 0,\n                lastAttempt: 0\n            };\n            if (Date.now() - failedLoginAttempts[clientIp].lastAttempt > ATTEMPT_WINDOW_MS) {\n                failedLoginAttempts[clientIp].count = 1; // Reset count if window expired\n            } else {\n                failedLoginAttempts[clientIp].count++;\n            }\n            failedLoginAttempts[clientIp].lastAttempt = Date.now();\n            if (failedLoginAttempts[clientIp].count >= MAX_FAILED_ATTEMPTS) {\n                blockedIPs[clientIp] = Date.now() + BLOCK_DURATION_MS;\n                const timeLeft = Math.ceil(BLOCK_DURATION_MS / 1000 / 60);\n                return res.status(429).json({\n                    message: `Too many failed login attempts. Please try again in ${timeLeft} minutes.`\n                });\n            }\n            return res.status(401).json({\n                message: \"Invalid credentials\"\n            });\n        }\n        const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_0___default().compare(password, user.password);\n        if (!isPasswordValid) {\n            // Increment failed attempts\n            failedLoginAttempts[clientIp] = failedLoginAttempts[clientIp] || {\n                count: 0,\n                lastAttempt: 0\n            };\n            if (Date.now() - failedLoginAttempts[clientIp].lastAttempt > ATTEMPT_WINDOW_MS) {\n                failedLoginAttempts[clientIp].count = 1; // Reset count if window expired\n            } else {\n                failedLoginAttempts[clientIp].count++;\n            }\n            failedLoginAttempts[clientIp].lastAttempt = Date.now();\n            if (failedLoginAttempts[clientIp].count >= MAX_FAILED_ATTEMPTS) {\n                blockedIPs[clientIp] = Date.now() + BLOCK_DURATION_MS;\n                const timeLeft = Math.ceil(BLOCK_DURATION_MS / 1000 / 60);\n                return res.status(429).json({\n                    message: `Too many failed login attempts. Please try again in ${timeLeft} minutes.`\n                });\n            }\n            return res.status(401).json({\n                message: \"Invalid credentials\"\n            });\n        }\n        // If login is successful, reset failed attempts for this IP\n        if (failedLoginAttempts[clientIp]) {\n            delete failedLoginAttempts[clientIp];\n        }\n        if (blockedIPs[clientIp]) {\n            delete blockedIPs[clientIp];\n        }\n        // Generate JWT token\n        const token = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().sign({\n            id: user.id,\n            username: user.username\n        }, JWT_SECRET, {\n            expiresIn: \"2h\"\n        });\n        res.status(200).json({\n            token\n        });\n    } catch (error) {\n        console.error(\"Authentication error:\", error);\n        res.status(500).json({\n            message: \"Internal server error\",\n            error: error instanceof Error ? error.message : String(error)\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDdkN0QyxZQUNBO1lBQUVtRCxXQUFXO1FBQUs7UUFHcEJoQyxJQUFJRyxNQUFNLENBQUMsS0FBS0UsSUFBSSxDQUFDO1lBQUV3QjtRQUFNO0lBQy9CLEVBQUUsT0FBT2IsT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMseUJBQXlCQTtRQUN2Q2hCLElBQUlHLE1BQU0sQ0FBQyxLQUFLRSxJQUFJLENBQUM7WUFDbkJDLFNBQVM7WUFDVFUsT0FBT0EsaUJBQWlCQyxRQUFRRCxNQUFNVixPQUFPLEdBQUdZLE9BQU9GO1FBQ3pEO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3ZpdGUtcmVhY3QtdHlwZXNjcmlwdC1zdGFydGVyLy4vcGFnZXMvYXBpL2F1dGgudHM/ZmJlYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJztcbmltcG9ydCB7IGdldERCLCBpbml0aWFsaXplREIgfSBmcm9tICcuLi8uLi9zcmMvbGliL2RiJztcblxuY29uc3QgSldUX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3lvdXItc2VjcmV0LWtleSc7XG5cbi8vIEluaXRpYWxpemUgREIgZmxhZ1xubGV0IGRiSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuLy8gSW4tbWVtb3J5IHN0b3JlIGZvciBmYWlsZWQgbG9naW4gYXR0ZW1wdHMgYW5kIGJsb2NrZWQgSVBzXG5pbnRlcmZhY2UgRmFpbGVkQXR0ZW1wdCB7XG4gIGNvdW50OiBudW1iZXI7XG4gIGxhc3RBdHRlbXB0OiBudW1iZXI7XG59XG5jb25zdCBmYWlsZWRMb2dpbkF0dGVtcHRzOiBSZWNvcmQ8c3RyaW5nLCBGYWlsZWRBdHRlbXB0PiA9IHt9O1xuY29uc3QgYmxvY2tlZElQczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9OyAvLyBTdG9yZXMgSVAgLT4gYmxvY2tlZFVudGlsIHRpbWVzdGFtcFxuXG5jb25zdCBNQVhfRkFJTEVEX0FUVEVNUFRTID0gMztcbmNvbnN0IEJMT0NLX0RVUkFUSU9OX01TID0gMTUgKiA2MCAqIDEwMDA7IC8vIDE1IG1pbnV0ZXNcbmNvbnN0IEFUVEVNUFRfV0lORE9XX01TID0gNSAqIDYwICogMTAwMDsgLy8gUmVzZXQgYXR0ZW1wdHMgaWYgbm8gbmV3IGF0dGVtcHQgaW4gNSBtaW5zXG5cbmZ1bmN0aW9uIGdldENsaWVudElwKHJlcTogTmV4dEFwaVJlcXVlc3QpOiBzdHJpbmcge1xuICBjb25zdCB4Rm9yd2FyZGVkRm9yID0gcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddO1xuICBpZiAodHlwZW9mIHhGb3J3YXJkZWRGb3IgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIHhGb3J3YXJkZWRGb3Iuc3BsaXQoJywnKVswXS50cmltKCk7XG4gIH1cbiAgY29uc3QgeFJlYWxJcCA9IHJlcS5oZWFkZXJzWyd4LXJlYWwtaXAnXTtcbiAgaWYgKHR5cGVvZiB4UmVhbElwID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiB4UmVhbElwLnRyaW0oKTtcbiAgfVxuICByZXR1cm4gcmVxLnNvY2tldC5yZW1vdGVBZGRyZXNzIHx8ICd1bmtub3duJztcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICAvLyBTZXQgcHJvcGVyIEpTT04gY29udGVudCB0eXBlXG4gIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gIFxuICAvLyBIYW5kbGUgcHJlZmxpZ2h0IE9QVElPTlMgcmVxdWVzdCBmb3IgQ09SU1xuICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5lbmQoKTtcbiAgfVxuICBcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IG1lc3NhZ2U6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xuICB9XG5cbiAgY29uc3QgY2xpZW50SXAgPSBnZXRDbGllbnRJcChyZXEpO1xuXG4gIC8vIENoZWNrIGlmIElQIGlzIGJsb2NrZWRcbiAgaWYgKGJsb2NrZWRJUHNbY2xpZW50SXBdICYmIGJsb2NrZWRJUHNbY2xpZW50SXBdID4gRGF0ZS5ub3coKSkge1xuICAgIGNvbnN0IHRpbWVMZWZ0ID0gTWF0aC5jZWlsKChibG9ja2VkSVBzW2NsaWVudElwXSAtIERhdGUubm93KCkpIC8gMTAwMCAvIDYwKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oeyBtZXNzYWdlOiBgVG9vIG1hbnkgZmFpbGVkIGxvZ2luIGF0dGVtcHRzLiBQbGVhc2UgdHJ5IGFnYWluIGluICR7dGltZUxlZnR9IG1pbnV0ZXMuYCB9KTtcbiAgfSBlbHNlIGlmIChibG9ja2VkSVBzW2NsaWVudElwXSAmJiBibG9ja2VkSVBzW2NsaWVudElwXSA8PSBEYXRlLm5vdygpKSB7XG4gICAgZGVsZXRlIGJsb2NrZWRJUHNbY2xpZW50SXBdOyAvLyBVbmJsb2NrIGlmIHRpbWUgaGFzIHBhc3NlZFxuICAgIGRlbGV0ZSBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXTsgLy8gQWxzbyBjbGVhciBhdHRlbXB0c1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBJbml0aWFsaXplIGRhdGFiYXNlIGlmIG5vdCBhbHJlYWR5IGRvbmVcbiAgICBpZiAoIWRiSW5pdGlhbGl6ZWQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGluaXRpYWxpemVEQigpO1xuICAgICAgICBkYkluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgY29uc29sZS5sb2coJ0RCIGluaXRpYWxpemVkIGluIGF1dGggQVBJJyk7XG4gICAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIGRhdGFiYXNlOicsIGRiRXJyb3IpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBpbml0aWFsaXphdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIGVycm9yOiBkYkVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBkYkVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZGJFcnJvcilcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghdXNlcm5hbWUgfHwgIXBhc3N3b3JkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnVXNlcm5hbWUgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREQigpO1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBkYi5nZXQoJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgdXNlcm5hbWUgPSA/JywgW3VzZXJuYW1lXSk7XG5cbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIC8vIEdlbmVyaWMgbWVzc2FnZSBmb3Igbm9uLWV4aXN0ZW50IHVzZXIgb3Igd3JvbmcgcGFzc3dvcmQgdG8gcHJldmVudCB1c2VybmFtZSBlbnVtZXJhdGlvblxuICAgICAgLy8gSW5jcmVtZW50IGZhaWxlZCBhdHRlbXB0c1xuICAgICAgZmFpbGVkTG9naW5BdHRlbXB0c1tjbGllbnRJcF0gPSBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXSB8fCB7IGNvdW50OiAwLCBsYXN0QXR0ZW1wdDogMCB9O1xuICAgICAgaWYgKERhdGUubm93KCkgLSBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXS5sYXN0QXR0ZW1wdCA+IEFUVEVNUFRfV0lORE9XX01TKSB7XG4gICAgICAgIGZhaWxlZExvZ2luQXR0ZW1wdHNbY2xpZW50SXBdLmNvdW50ID0gMTsgLy8gUmVzZXQgY291bnQgaWYgd2luZG93IGV4cGlyZWRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZhaWxlZExvZ2luQXR0ZW1wdHNbY2xpZW50SXBdLmNvdW50Kys7XG4gICAgICB9XG4gICAgICBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXS5sYXN0QXR0ZW1wdCA9IERhdGUubm93KCk7XG5cbiAgICAgIGlmIChmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXS5jb3VudCA+PSBNQVhfRkFJTEVEX0FUVEVNUFRTKSB7XG4gICAgICAgIGJsb2NrZWRJUHNbY2xpZW50SXBdID0gRGF0ZS5ub3coKSArIEJMT0NLX0RVUkFUSU9OX01TO1xuICAgICAgICBjb25zdCB0aW1lTGVmdCA9IE1hdGguY2VpbChCTE9DS19EVVJBVElPTl9NUyAvIDEwMDAgLyA2MCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IG1lc3NhZ2U6IGBUb28gbWFueSBmYWlsZWQgbG9naW4gYXR0ZW1wdHMuIFBsZWFzZSB0cnkgYWdhaW4gaW4gJHt0aW1lTGVmdH0gbWludXRlcy5gIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ0ludmFsaWQgY3JlZGVudGlhbHMnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKTtcbiAgICBcbiAgICBpZiAoIWlzUGFzc3dvcmRWYWxpZCkge1xuICAgICAgLy8gSW5jcmVtZW50IGZhaWxlZCBhdHRlbXB0c1xuICAgICAgZmFpbGVkTG9naW5BdHRlbXB0c1tjbGllbnRJcF0gPSBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXSB8fCB7IGNvdW50OiAwLCBsYXN0QXR0ZW1wdDogMCB9O1xuICAgICAgIGlmIChEYXRlLm5vdygpIC0gZmFpbGVkTG9naW5BdHRlbXB0c1tjbGllbnRJcF0ubGFzdEF0dGVtcHQgPiBBVFRFTVBUX1dJTkRPV19NUykge1xuICAgICAgICBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXS5jb3VudCA9IDE7IC8vIFJlc2V0IGNvdW50IGlmIHdpbmRvdyBleHBpcmVkXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXS5jb3VudCsrO1xuICAgICAgfVxuICAgICAgZmFpbGVkTG9naW5BdHRlbXB0c1tjbGllbnRJcF0ubGFzdEF0dGVtcHQgPSBEYXRlLm5vdygpO1xuXG4gICAgICBpZiAoZmFpbGVkTG9naW5BdHRlbXB0c1tjbGllbnRJcF0uY291bnQgPj0gTUFYX0ZBSUxFRF9BVFRFTVBUUykge1xuICAgICAgICBibG9ja2VkSVBzW2NsaWVudElwXSA9IERhdGUubm93KCkgKyBCTE9DS19EVVJBVElPTl9NUztcbiAgICAgICAgY29uc3QgdGltZUxlZnQgPSBNYXRoLmNlaWwoQkxPQ0tfRFVSQVRJT05fTVMgLyAxMDAwIC8gNjApO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oeyBtZXNzYWdlOiBgVG9vIG1hbnkgZmFpbGVkIGxvZ2luIGF0dGVtcHRzLiBQbGVhc2UgdHJ5IGFnYWluIGluICR7dGltZUxlZnR9IG1pbnV0ZXMuYCB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyB9KTtcbiAgICB9XG5cbiAgICAvLyBJZiBsb2dpbiBpcyBzdWNjZXNzZnVsLCByZXNldCBmYWlsZWQgYXR0ZW1wdHMgZm9yIHRoaXMgSVBcbiAgICBpZiAoZmFpbGVkTG9naW5BdHRlbXB0c1tjbGllbnRJcF0pIHtcbiAgICAgIGRlbGV0ZSBmYWlsZWRMb2dpbkF0dGVtcHRzW2NsaWVudElwXTtcbiAgICB9XG4gICAgaWYgKGJsb2NrZWRJUHNbY2xpZW50SXBdKSB7IC8vIFNob3VsZCBub3QgaGFwcGVuIGlmIGFscmVhZHkgY2hlY2tlZCwgYnV0IGdvb2QgZm9yIHNhZmV0eVxuICAgICAgICBkZWxldGUgYmxvY2tlZElQc1tjbGllbnRJcF07XG4gICAgfVxuICAgIFxuICAgIC8vIEdlbmVyYXRlIEpXVCB0b2tlblxuICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oXG4gICAgICB7IGlkOiB1c2VyLmlkLCB1c2VybmFtZTogdXNlci51c2VybmFtZSB9LFxuICAgICAgSldUX1NFQ1JFVCxcbiAgICAgIHsgZXhwaXJlc0luOiAnMmgnIH1cbiAgICApO1xuXG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB0b2tlbiB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBdXRoZW50aWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgIH0pO1xuICB9XG59ICJdLCJuYW1lcyI6WyJiY3J5cHQiLCJqd3QiLCJnZXREQiIsImluaXRpYWxpemVEQiIsIkpXVF9TRUNSRVQiLCJwcm9jZXNzIiwiZW52IiwiZGJJbml0aWFsaXplZCIsImZhaWxlZExvZ2luQXR0ZW1wdHMiLCJibG9ja2VkSVBzIiwiTUFYX0ZBSUxFRF9BVFRFTVBUUyIsIkJMT0NLX0RVUkFUSU9OX01TIiwiQVRURU1QVF9XSU5ET1dfTVMiLCJnZXRDbGllbnRJcCIsInJlcSIsInhGb3J3YXJkZWRGb3IiLCJoZWFkZXJzIiwic3BsaXQiLCJ0cmltIiwieFJlYWxJcCIsInNvY2tldCIsInJlbW90ZUFkZHJlc3MiLCJoYW5kbGVyIiwicmVzIiwic2V0SGVhZGVyIiwibWV0aG9kIiwic3RhdHVzIiwiZW5kIiwianNvbiIsIm1lc3NhZ2UiLCJjbGllbnRJcCIsIkRhdGUiLCJub3ciLCJ0aW1lTGVmdCIsIk1hdGgiLCJjZWlsIiwiY29uc29sZSIsImxvZyIsImRiRXJyb3IiLCJlcnJvciIsIkVycm9yIiwiU3RyaW5nIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImJvZHkiLCJkYiIsInVzZXIiLCJnZXQiLCJjb3VudCIsImxhc3RBdHRlbXB0IiwiaXNQYXNzd29yZFZhbGlkIiwiY29tcGFyZSIsInRva2VuIiwic2lnbiIsImlkIiwiZXhwaXJlc0luIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/auth.ts\n");

/***/ }),

/***/ "(api)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeDB: () => (/* binding */ closeDB),\n/* harmony export */   getDB: () => (/* binding */ getDB),\n/* harmony export */   initializeDB: () => (/* binding */ initializeDB)\n/* harmony export */ });\n// Check if we're running on the server to avoid errors in the browser\nconst isServer = \"undefined\" === \"undefined\";\n// Check if database file exists\nconst doesDBFileExist = async ()=>{\n    if (!isServer) return false;\n    try {\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n        const dbPath = path.join(process.cwd(), \"data.db\");\n        return fs.existsSync(dbPath);\n    } catch (error) {\n        console.error(\"Error checking if DB file exists:\", error);\n        return false;\n    }\n};\n// Track if this is the first time initializing\nlet isFirstInitialization = true;\n// Initialize database\nasync function initializeDB() {\n    if (!isServer) {\n        throw new Error(\"Database operations can only be performed on the server\");\n    }\n    try {\n        // Check if this is the first time running or if the file exists\n        const dbFileExisted = await doesDBFileExist();\n        // Dynamic imports to avoid issues with client-side code\n        const { open } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! sqlite */ \"sqlite\"));\n        const sqlite3 = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sqlite3 */ \"sqlite3\", 23));\n        const bcrypt = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! bcryptjs */ \"bcryptjs\", 23));\n        const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n        const url = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! url */ \"url\", 23));\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        // Setup paths\n        const __filename = url.fileURLToPath(\"file:///home/user456/project-main-1-1/src/lib/db.ts\");\n        const __dirname = path.dirname(__filename);\n        const DB_PATH = path.join(process.cwd(), \"data.db\");\n        console.log(\"Initializing database at:\", DB_PATH);\n        const db = await open({\n            filename: DB_PATH,\n            driver: sqlite3.default.Database\n        });\n        console.log(\"Connected to database\");\n        // Create tables if they don't exist\n        await db.exec(`\n      CREATE TABLE IF NOT EXISTS users (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        username TEXT UNIQUE NOT NULL,\n        password TEXT NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      );\n\n      CREATE TABLE IF NOT EXISTS categories (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT UNIQUE NOT NULL,\n        description TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      );\n\n      CREATE TABLE IF NOT EXISTS products (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL,\n        description TEXT,\n        image TEXT,\n        specs TEXT,\n        useCases TEXT,\n        category TEXT,\n        images TEXT,\n        document TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (category) REFERENCES categories(name)\n      );\n      \n      CREATE TABLE IF NOT EXISTS job_openings (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        department TEXT NOT NULL,\n        location TEXT NOT NULL,\n        type TEXT NOT NULL,\n        description TEXT NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        active INTEGER DEFAULT 1\n      );\n    `);\n        console.log(\"Database tables created\");\n        // Alter existing products table to add document column if it doesn't exist\n        try {\n            // Check if the document column exists\n            const tableInfo = await db.all(\"PRAGMA table_info(products)\");\n            const documentColumnExists = tableInfo.some((column)=>column.name === \"document\");\n            if (!documentColumnExists) {\n                // Add document column to products table\n                await db.exec(\"ALTER TABLE products ADD COLUMN document TEXT\");\n                console.log(\"Added document column to products table\");\n            }\n        } catch (error) {\n            console.error(\"Error altering products table:\", error);\n        }\n        // Check if admin user exists, if not create it\n        const adminUser = await db.get(\"SELECT * FROM users WHERE username = ?\", [\n            \"admin\"\n        ]);\n        if (!adminUser) {\n            const hashedPassword = await bcrypt.hash(\"Azerbaycan123\", 10);\n            await db.run(\"INSERT INTO users (username, password) VALUES (?, ?)\", [\n                \"admin\",\n                hashedPassword\n            ]);\n            console.log(\"Admin user created\");\n        }\n        // Initialize default categories if none exist\n        const categoriesCount = await db.get(\"SELECT COUNT(*) as count FROM categories\");\n        if (categoriesCount.count === 0) {\n            const defaultCategories = [\n                {\n                    name: \"Industrial Equipment\",\n                    description: \"Heavy-duty industrial machinery and equipment\"\n                },\n                {\n                    name: \"Safety Gear\",\n                    description: \"Personal protective equipment and safety solutions\"\n                },\n                {\n                    name: \"Measurement Tools\",\n                    description: \"Precision measurement and testing instruments\"\n                },\n                {\n                    name: \"Fluid Control\",\n                    description: \"Valves, pumps, and fluid management systems\"\n                },\n                {\n                    name: \"Power Systems\",\n                    description: \"Power generation and electrical equipment\"\n                },\n                {\n                    name: \"Construction Equipment\",\n                    description: \"Tools and equipment for construction projects\"\n                }\n            ];\n            for (const category of defaultCategories){\n                await db.run(\"INSERT INTO categories (name, description) VALUES (?, ?)\", [\n                    category.name,\n                    category.description\n                ]);\n            }\n        }\n        // Only import initial products if this is a brand new database (file didn't exist before)\n        // and the products table is empty\n        const productsCount = await db.get(\"SELECT COUNT(*) as count FROM products\");\n        if (productsCount.count === 0 && !dbFileExisted && isFirstInitialization) {\n            try {\n                // Try to load products from JSON file\n                const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n                const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n                const productsJsonPath = path.join(process.cwd(), \"src\", \"data\", \"products.json\");\n                let products = [];\n                if (fs.existsSync(productsJsonPath)) {\n                    // Read JSON file\n                    const productsJson = fs.readFileSync(productsJsonPath, \"utf8\");\n                    products = JSON.parse(productsJson);\n                    console.log(\"Loaded products from JSON file\");\n                } else {\n                    // Fallback to default product\n                    products = [\n                        {\n                            id: 1,\n                            name: \"Sample Product\",\n                            description: \"A sample product created automatically\",\n                            image: \"https://placehold.co/600x400?text=Sample+Product\",\n                            specs: [\n                                \"Sample specification 1\",\n                                \"Sample specification 2\"\n                            ],\n                            useCases: [\n                                \"Sample use case 1\",\n                                \"Sample use case 2\"\n                            ],\n                            category: \"Sample Category\"\n                        }\n                    ];\n                    console.log(\"Using default product as fallback\");\n                }\n                // Insert products\n                for (const product of products){\n                    await db.run(\"INSERT INTO products (id, name, description, image, specs, useCases, category) VALUES (?, ?, ?, ?, ?, ?, ?)\", [\n                        product.id,\n                        product.name,\n                        product.description,\n                        product.image,\n                        JSON.stringify(product.specs),\n                        JSON.stringify(product.useCases),\n                        product.category\n                    ]);\n                }\n                console.log(`${products.length} products inserted into database`);\n            } catch (error) {\n                console.error(\"Error importing initial products:\", error);\n            }\n        }\n        // Mark that we've already initialized once\n        isFirstInitialization = false;\n        // Initialize default job openings if none exist\n        const jobOpeningsCount = await db.get(\"SELECT COUNT(*) as count FROM job_openings\");\n        if (jobOpeningsCount.count === 0) {\n            const defaultJobs = [\n                {\n                    title: \"Supply Chain Manager\",\n                    department: \"operations\",\n                    location: \"Baku, Azerbaijan\",\n                    type: \"Full-time\",\n                    description: \"Leading and optimizing supply chain operations...\"\n                },\n                {\n                    title: \"Sales Representative\",\n                    department: \"sales\",\n                    location: \"Baku, Azerbaijan\",\n                    type: \"Full-time\",\n                    description: \"Developing and maintaining client relationships...\"\n                },\n                {\n                    title: \"Logistics Coordinator\",\n                    department: \"logistics\",\n                    location: \"Baku, Azerbaijan\",\n                    type: \"Full-time\",\n                    description: \"Coordinating shipment schedules and delivery routes...\"\n                }\n            ];\n            for (const job of defaultJobs){\n                await db.run(\"INSERT INTO job_openings (title, department, location, type, description) VALUES (?, ?, ?, ?, ?)\", [\n                    job.title,\n                    job.department,\n                    job.location,\n                    job.type,\n                    job.description\n                ]);\n            }\n            console.log(\"Default job openings created\");\n        }\n        // Store the db instance in module state\n        dbInstance = db;\n        return db;\n    } catch (error) {\n        console.error(\"Database initialization error:\", error);\n        throw error;\n    }\n}\n// Get database instance\nlet dbInstance = null;\nasync function getDB() {\n    if (!isServer) {\n        throw new Error(\"Database operations can only be performed on the server\");\n    }\n    if (!dbInstance) {\n        dbInstance = await initializeDB();\n    }\n    return dbInstance;\n}\n// Close database connection\nasync function closeDB() {\n    if (!isServer) {\n        throw new Error(\"Database operations can only be performed on the server\");\n    }\n    if (dbInstance) {\n        await dbInstance.close();\n        dbInstance = null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUlILFVBQVU7b0JBQUVHLElBQUlGLFFBQVE7b0JBQUVFLElBQUlELElBQUk7b0JBQUVDLElBQUl0QixXQUFXO2lCQUFDO1lBRXhFO1lBQ0FuQyxRQUFRYyxHQUFHLENBQUM7UUFDZDtRQUVBLHdDQUF3QztRQUN4QzRDLGFBQWEzQztRQUNiLE9BQU9BO0lBQ1QsRUFBRSxPQUFPaEIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsa0NBQWtDQTtRQUNoRCxNQUFNQTtJQUNSO0FBQ0Y7QUFFQSx3QkFBd0I7QUFDeEIsSUFBSTJELGFBQXlCO0FBRXRCLGVBQWVDO0lBQ3BCLElBQUksQ0FBQ3JFLFVBQVU7UUFDYixNQUFNLElBQUlhLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUN1RCxZQUFZO1FBQ2ZBLGFBQWEsTUFBTXhEO0lBQ3JCO0lBQ0EsT0FBT3dEO0FBQ1Q7QUFFQSw0QkFBNEI7QUFDckIsZUFBZUU7SUFDcEIsSUFBSSxDQUFDdEUsVUFBVTtRQUNiLE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtJQUVBLElBQUl1RCxZQUFZO1FBQ2QsTUFBTUEsV0FBV0csS0FBSztRQUN0QkgsYUFBYTtJQUNmO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aXRlLXJlYWN0LXR5cGVzY3JpcHQtc3RhcnRlci8uL3NyYy9saWIvZGIudHM/OWU0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDaGVjayBpZiB3ZSdyZSBydW5uaW5nIG9uIHRoZSBzZXJ2ZXIgdG8gYXZvaWQgZXJyb3JzIGluIHRoZSBicm93c2VyXG5jb25zdCBpc1NlcnZlciA9IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnO1xuXG4vLyBUeXBlIGZvciBkYXRhYmFzZSBpbnN0YW5jZVxudHlwZSBEQkluc3RhbmNlID0gYW55O1xuXG4vLyBDaGVjayBpZiBkYXRhYmFzZSBmaWxlIGV4aXN0c1xuY29uc3QgZG9lc0RCRmlsZUV4aXN0ID0gYXN5bmMgKCkgPT4ge1xuICBpZiAoIWlzU2VydmVyKSByZXR1cm4gZmFsc2U7XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IGZzID0gYXdhaXQgaW1wb3J0KCdmcycpO1xuICAgIGNvbnN0IHBhdGggPSBhd2FpdCBpbXBvcnQoJ3BhdGgnKTtcbiAgICBjb25zdCBkYlBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEuZGInKTtcbiAgICByZXR1cm4gZnMuZXhpc3RzU3luYyhkYlBhdGgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIGlmIERCIGZpbGUgZXhpc3RzOicsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8vIFRyYWNrIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHRpbWUgaW5pdGlhbGl6aW5nXG5sZXQgaXNGaXJzdEluaXRpYWxpemF0aW9uID0gdHJ1ZTtcblxuLy8gSW5pdGlhbGl6ZSBkYXRhYmFzZVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVEQigpIHtcbiAgaWYgKCFpc1NlcnZlcikge1xuICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugb3BlcmF0aW9ucyBjYW4gb25seSBiZSBwZXJmb3JtZWQgb24gdGhlIHNlcnZlcicpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIHRoZSBmaXJzdCB0aW1lIHJ1bm5pbmcgb3IgaWYgdGhlIGZpbGUgZXhpc3RzXG4gICAgY29uc3QgZGJGaWxlRXhpc3RlZCA9IGF3YWl0IGRvZXNEQkZpbGVFeGlzdCgpO1xuICAgIFxuICAgIC8vIER5bmFtaWMgaW1wb3J0cyB0byBhdm9pZCBpc3N1ZXMgd2l0aCBjbGllbnQtc2lkZSBjb2RlXG4gICAgY29uc3QgeyBvcGVuIH0gPSBhd2FpdCBpbXBvcnQoJ3NxbGl0ZScpO1xuICAgIGNvbnN0IHNxbGl0ZTMgPSBhd2FpdCBpbXBvcnQoJ3NxbGl0ZTMnKTtcbiAgICBjb25zdCBiY3J5cHQgPSBhd2FpdCBpbXBvcnQoJ2JjcnlwdGpzJyk7XG4gICAgY29uc3QgcGF0aCA9IGF3YWl0IGltcG9ydCgncGF0aCcpO1xuICAgIGNvbnN0IHVybCA9IGF3YWl0IGltcG9ydCgndXJsJyk7XG4gICAgY29uc3QgZnMgPSBhd2FpdCBpbXBvcnQoJ2ZzJyk7XG5cbiAgICAvLyBTZXR1cCBwYXRoc1xuICAgIGNvbnN0IF9fZmlsZW5hbWUgPSB1cmwuZmlsZVVSTFRvUGF0aChpbXBvcnQubWV0YS51cmwpO1xuICAgIGNvbnN0IF9fZGlybmFtZSA9IHBhdGguZGlybmFtZShfX2ZpbGVuYW1lKTtcbiAgICBjb25zdCBEQl9QQVRIID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkYXRhLmRiJyk7XG5cbiAgICBjb25zb2xlLmxvZygnSW5pdGlhbGl6aW5nIGRhdGFiYXNlIGF0OicsIERCX1BBVEgpO1xuICAgIFxuICAgIGNvbnN0IGRiID0gYXdhaXQgb3Blbih7XG4gICAgICBmaWxlbmFtZTogREJfUEFUSCxcbiAgICAgIGRyaXZlcjogc3FsaXRlMy5kZWZhdWx0LkRhdGFiYXNlXG4gICAgfSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCB0byBkYXRhYmFzZScpO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0YWJsZXMgaWYgdGhleSBkb24ndCBleGlzdFxuICAgIGF3YWl0IGRiLmV4ZWMoYFxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcnMgKFxuICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgICAgIHVzZXJuYW1lIFRFWFQgVU5JUVVFIE5PVCBOVUxMLFxuICAgICAgICBwYXNzd29yZCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBjcmVhdGVkX2F0IERBVEVUSU1FIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVBcbiAgICAgICk7XG5cbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNhdGVnb3JpZXMgKFxuICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgICAgIG5hbWUgVEVYVCBVTklRVUUgTk9UIE5VTEwsXG4gICAgICAgIGRlc2NyaXB0aW9uIFRFWFQsXG4gICAgICAgIGNyZWF0ZWRfYXQgREFURVRJTUUgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgKTtcblxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcHJvZHVjdHMgKFxuICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgICAgIG5hbWUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZGVzY3JpcHRpb24gVEVYVCxcbiAgICAgICAgaW1hZ2UgVEVYVCxcbiAgICAgICAgc3BlY3MgVEVYVCxcbiAgICAgICAgdXNlQ2FzZXMgVEVYVCxcbiAgICAgICAgY2F0ZWdvcnkgVEVYVCxcbiAgICAgICAgaW1hZ2VzIFRFWFQsXG4gICAgICAgIGRvY3VtZW50IFRFWFQsXG4gICAgICAgIGNyZWF0ZWRfYXQgREFURVRJTUUgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUCxcbiAgICAgICAgRk9SRUlHTiBLRVkgKGNhdGVnb3J5KSBSRUZFUkVOQ0VTIGNhdGVnb3JpZXMobmFtZSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGpvYl9vcGVuaW5ncyAoXG4gICAgICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVkgQVVUT0lOQ1JFTUVOVCxcbiAgICAgICAgdGl0bGUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZGVwYXJ0bWVudCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBsb2NhdGlvbiBURVhUIE5PVCBOVUxMLFxuICAgICAgICB0eXBlIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGRlc2NyaXB0aW9uIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGNyZWF0ZWRfYXQgREFURVRJTUUgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUCxcbiAgICAgICAgYWN0aXZlIElOVEVHRVIgREVGQVVMVCAxXG4gICAgICApO1xuICAgIGApO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSB0YWJsZXMgY3JlYXRlZCcpO1xuXG4gICAgLy8gQWx0ZXIgZXhpc3RpbmcgcHJvZHVjdHMgdGFibGUgdG8gYWRkIGRvY3VtZW50IGNvbHVtbiBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBkb2N1bWVudCBjb2x1bW4gZXhpc3RzXG4gICAgICBjb25zdCB0YWJsZUluZm8gPSBhd2FpdCBkYi5hbGwoJ1BSQUdNQSB0YWJsZV9pbmZvKHByb2R1Y3RzKScpO1xuICAgICAgY29uc3QgZG9jdW1lbnRDb2x1bW5FeGlzdHMgPSB0YWJsZUluZm8uc29tZSgoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5uYW1lID09PSAnZG9jdW1lbnQnKTtcbiAgICAgIFxuICAgICAgaWYgKCFkb2N1bWVudENvbHVtbkV4aXN0cykge1xuICAgICAgICAvLyBBZGQgZG9jdW1lbnQgY29sdW1uIHRvIHByb2R1Y3RzIHRhYmxlXG4gICAgICAgIGF3YWl0IGRiLmV4ZWMoJ0FMVEVSIFRBQkxFIHByb2R1Y3RzIEFERCBDT0xVTU4gZG9jdW1lbnQgVEVYVCcpO1xuICAgICAgICBjb25zb2xlLmxvZygnQWRkZWQgZG9jdW1lbnQgY29sdW1uIHRvIHByb2R1Y3RzIHRhYmxlJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsdGVyaW5nIHByb2R1Y3RzIHRhYmxlOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBhZG1pbiB1c2VyIGV4aXN0cywgaWYgbm90IGNyZWF0ZSBpdFxuICAgIGNvbnN0IGFkbWluVXNlciA9IGF3YWl0IGRiLmdldCgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSB1c2VybmFtZSA9ID8nLCBbJ2FkbWluJ10pO1xuICAgIFxuICAgIGlmICghYWRtaW5Vc2VyKSB7XG4gICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKCdBemVyYmF5Y2FuMTIzJywgMTApO1xuICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAnSU5TRVJUIElOVE8gdXNlcnMgKHVzZXJuYW1lLCBwYXNzd29yZCkgVkFMVUVTICg/LCA/KScsXG4gICAgICAgIFsnYWRtaW4nLCBoYXNoZWRQYXNzd29yZF1cbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZygnQWRtaW4gdXNlciBjcmVhdGVkJyk7XG4gICAgfVxuXG4gICAgLy8gSW5pdGlhbGl6ZSBkZWZhdWx0IGNhdGVnb3JpZXMgaWYgbm9uZSBleGlzdFxuICAgIGNvbnN0IGNhdGVnb3JpZXNDb3VudCA9IGF3YWl0IGRiLmdldCgnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gY2F0ZWdvcmllcycpO1xuICAgIGlmIChjYXRlZ29yaWVzQ291bnQuY291bnQgPT09IDApIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRDYXRlZ29yaWVzID0gW1xuICAgICAgICB7IG5hbWU6ICdJbmR1c3RyaWFsIEVxdWlwbWVudCcsIGRlc2NyaXB0aW9uOiAnSGVhdnktZHV0eSBpbmR1c3RyaWFsIG1hY2hpbmVyeSBhbmQgZXF1aXBtZW50JyB9LFxuICAgICAgICB7IG5hbWU6ICdTYWZldHkgR2VhcicsIGRlc2NyaXB0aW9uOiAnUGVyc29uYWwgcHJvdGVjdGl2ZSBlcXVpcG1lbnQgYW5kIHNhZmV0eSBzb2x1dGlvbnMnIH0sXG4gICAgICAgIHsgbmFtZTogJ01lYXN1cmVtZW50IFRvb2xzJywgZGVzY3JpcHRpb246ICdQcmVjaXNpb24gbWVhc3VyZW1lbnQgYW5kIHRlc3RpbmcgaW5zdHJ1bWVudHMnIH0sXG4gICAgICAgIHsgbmFtZTogJ0ZsdWlkIENvbnRyb2wnLCBkZXNjcmlwdGlvbjogJ1ZhbHZlcywgcHVtcHMsIGFuZCBmbHVpZCBtYW5hZ2VtZW50IHN5c3RlbXMnIH0sXG4gICAgICAgIHsgbmFtZTogJ1Bvd2VyIFN5c3RlbXMnLCBkZXNjcmlwdGlvbjogJ1Bvd2VyIGdlbmVyYXRpb24gYW5kIGVsZWN0cmljYWwgZXF1aXBtZW50JyB9LFxuICAgICAgICB7IG5hbWU6ICdDb25zdHJ1Y3Rpb24gRXF1aXBtZW50JywgZGVzY3JpcHRpb246ICdUb29scyBhbmQgZXF1aXBtZW50IGZvciBjb25zdHJ1Y3Rpb24gcHJvamVjdHMnIH1cbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgZGVmYXVsdENhdGVnb3JpZXMpIHtcbiAgICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAgICdJTlNFUlQgSU5UTyBjYXRlZ29yaWVzIChuYW1lLCBkZXNjcmlwdGlvbikgVkFMVUVTICg/LCA/KScsXG4gICAgICAgICAgW2NhdGVnb3J5Lm5hbWUsIGNhdGVnb3J5LmRlc2NyaXB0aW9uXVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE9ubHkgaW1wb3J0IGluaXRpYWwgcHJvZHVjdHMgaWYgdGhpcyBpcyBhIGJyYW5kIG5ldyBkYXRhYmFzZSAoZmlsZSBkaWRuJ3QgZXhpc3QgYmVmb3JlKVxuICAgIC8vIGFuZCB0aGUgcHJvZHVjdHMgdGFibGUgaXMgZW1wdHlcbiAgICBjb25zdCBwcm9kdWN0c0NvdW50ID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwcm9kdWN0cycpO1xuICAgIFxuICAgIGlmIChwcm9kdWN0c0NvdW50LmNvdW50ID09PSAwICYmICFkYkZpbGVFeGlzdGVkICYmIGlzRmlyc3RJbml0aWFsaXphdGlvbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVHJ5IHRvIGxvYWQgcHJvZHVjdHMgZnJvbSBKU09OIGZpbGVcbiAgICAgICAgY29uc3QgZnMgPSBhd2FpdCBpbXBvcnQoJ2ZzJyk7XG4gICAgICAgIGNvbnN0IHBhdGggPSBhd2FpdCBpbXBvcnQoJ3BhdGgnKTtcbiAgICAgICAgY29uc3QgcHJvZHVjdHNKc29uUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnc3JjJywgJ2RhdGEnLCAncHJvZHVjdHMuanNvbicpO1xuICAgICAgICBcbiAgICAgICAgbGV0IHByb2R1Y3RzID0gW107XG4gICAgICAgIFxuICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhwcm9kdWN0c0pzb25QYXRoKSkge1xuICAgICAgICAgIC8vIFJlYWQgSlNPTiBmaWxlXG4gICAgICAgICAgY29uc3QgcHJvZHVjdHNKc29uID0gZnMucmVhZEZpbGVTeW5jKHByb2R1Y3RzSnNvblBhdGgsICd1dGY4Jyk7XG4gICAgICAgICAgcHJvZHVjdHMgPSBKU09OLnBhcnNlKHByb2R1Y3RzSnNvbik7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0xvYWRlZCBwcm9kdWN0cyBmcm9tIEpTT04gZmlsZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGRlZmF1bHQgcHJvZHVjdFxuICAgICAgICAgIHByb2R1Y3RzID0gW3tcbiAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgbmFtZTogXCJTYW1wbGUgUHJvZHVjdFwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQSBzYW1wbGUgcHJvZHVjdCBjcmVhdGVkIGF1dG9tYXRpY2FsbHlcIixcbiAgICAgICAgICAgIGltYWdlOiBcImh0dHBzOi8vcGxhY2Vob2xkLmNvLzYwMHg0MDA/dGV4dD1TYW1wbGUrUHJvZHVjdFwiLFxuICAgICAgICAgICAgc3BlY3M6IFtcIlNhbXBsZSBzcGVjaWZpY2F0aW9uIDFcIiwgXCJTYW1wbGUgc3BlY2lmaWNhdGlvbiAyXCJdLFxuICAgICAgICAgICAgdXNlQ2FzZXM6IFtcIlNhbXBsZSB1c2UgY2FzZSAxXCIsIFwiU2FtcGxlIHVzZSBjYXNlIDJcIl0sXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJTYW1wbGUgQ2F0ZWdvcnlcIlxuICAgICAgICAgIH1dO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdVc2luZyBkZWZhdWx0IHByb2R1Y3QgYXMgZmFsbGJhY2snKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSW5zZXJ0IHByb2R1Y3RzXG4gICAgICAgIGZvciAoY29uc3QgcHJvZHVjdCBvZiBwcm9kdWN0cykge1xuICAgICAgICAgIGF3YWl0IGRiLnJ1bihcbiAgICAgICAgICAgICdJTlNFUlQgSU5UTyBwcm9kdWN0cyAoaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZSwgc3BlY3MsIHVzZUNhc2VzLCBjYXRlZ29yeSkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/KScsXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgIHByb2R1Y3QuaWQsXG4gICAgICAgICAgICAgIHByb2R1Y3QubmFtZSxcbiAgICAgICAgICAgICAgcHJvZHVjdC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgcHJvZHVjdC5pbWFnZSxcbiAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkocHJvZHVjdC5zcGVjcyksXG4gICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHByb2R1Y3QudXNlQ2FzZXMpLFxuICAgICAgICAgICAgICBwcm9kdWN0LmNhdGVnb3J5XG4gICAgICAgICAgICBdXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhgJHtwcm9kdWN0cy5sZW5ndGh9IHByb2R1Y3RzIGluc2VydGVkIGludG8gZGF0YWJhc2VgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGltcG9ydGluZyBpbml0aWFsIHByb2R1Y3RzOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gTWFyayB0aGF0IHdlJ3ZlIGFscmVhZHkgaW5pdGlhbGl6ZWQgb25jZVxuICAgIGlzRmlyc3RJbml0aWFsaXphdGlvbiA9IGZhbHNlO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBkZWZhdWx0IGpvYiBvcGVuaW5ncyBpZiBub25lIGV4aXN0XG4gICAgY29uc3Qgam9iT3BlbmluZ3NDb3VudCA9IGF3YWl0IGRiLmdldCgnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gam9iX29wZW5pbmdzJyk7XG4gICAgaWYgKGpvYk9wZW5pbmdzQ291bnQuY291bnQgPT09IDApIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRKb2JzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VwcGx5IENoYWluIE1hbmFnZXJcIixcbiAgICAgICAgICBkZXBhcnRtZW50OiBcIm9wZXJhdGlvbnNcIixcbiAgICAgICAgICBsb2NhdGlvbjogXCJCYWt1LCBBemVyYmFpamFuXCIsXG4gICAgICAgICAgdHlwZTogXCJGdWxsLXRpbWVcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJMZWFkaW5nIGFuZCBvcHRpbWl6aW5nIHN1cHBseSBjaGFpbiBvcGVyYXRpb25zLi4uXCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBcIlNhbGVzIFJlcHJlc2VudGF0aXZlXCIsXG4gICAgICAgICAgZGVwYXJ0bWVudDogXCJzYWxlc1wiLFxuICAgICAgICAgIGxvY2F0aW9uOiBcIkJha3UsIEF6ZXJiYWlqYW5cIixcbiAgICAgICAgICB0eXBlOiBcIkZ1bGwtdGltZVwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkRldmVsb3BpbmcgYW5kIG1haW50YWluaW5nIGNsaWVudCByZWxhdGlvbnNoaXBzLi4uXCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBcIkxvZ2lzdGljcyBDb29yZGluYXRvclwiLFxuICAgICAgICAgIGRlcGFydG1lbnQ6IFwibG9naXN0aWNzXCIsXG4gICAgICAgICAgbG9jYXRpb246IFwiQmFrdSwgQXplcmJhaWphblwiLFxuICAgICAgICAgIHR5cGU6IFwiRnVsbC10aW1lXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiQ29vcmRpbmF0aW5nIHNoaXBtZW50IHNjaGVkdWxlcyBhbmQgZGVsaXZlcnkgcm91dGVzLi4uXCJcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBqb2Igb2YgZGVmYXVsdEpvYnMpIHtcbiAgICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAgICdJTlNFUlQgSU5UTyBqb2Jfb3BlbmluZ3MgKHRpdGxlLCBkZXBhcnRtZW50LCBsb2NhdGlvbiwgdHlwZSwgZGVzY3JpcHRpb24pIFZBTFVFUyAoPywgPywgPywgPywgPyknLFxuICAgICAgICAgIFtqb2IudGl0bGUsIGpvYi5kZXBhcnRtZW50LCBqb2IubG9jYXRpb24sIGpvYi50eXBlLCBqb2IuZGVzY3JpcHRpb25dXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZygnRGVmYXVsdCBqb2Igb3BlbmluZ3MgY3JlYXRlZCcpO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIHRoZSBkYiBpbnN0YW5jZSBpbiBtb2R1bGUgc3RhdGVcbiAgICBkYkluc3RhbmNlID0gZGI7XG4gICAgcmV0dXJuIGRiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0RhdGFiYXNlIGluaXRpYWxpemF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBHZXQgZGF0YWJhc2UgaW5zdGFuY2VcbmxldCBkYkluc3RhbmNlOiBEQkluc3RhbmNlID0gbnVsbDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERCKCkge1xuICBpZiAoIWlzU2VydmVyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBvcGVyYXRpb25zIGNhbiBvbmx5IGJlIHBlcmZvcm1lZCBvbiB0aGUgc2VydmVyJyk7XG4gIH1cbiAgXG4gIGlmICghZGJJbnN0YW5jZSkge1xuICAgIGRiSW5zdGFuY2UgPSBhd2FpdCBpbml0aWFsaXplREIoKTtcbiAgfVxuICByZXR1cm4gZGJJbnN0YW5jZTtcbn1cblxuLy8gQ2xvc2UgZGF0YWJhc2UgY29ubmVjdGlvblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlREIoKSB7XG4gIGlmICghaXNTZXJ2ZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG9wZXJhdGlvbnMgY2FuIG9ubHkgYmUgcGVyZm9ybWVkIG9uIHRoZSBzZXJ2ZXInKTtcbiAgfVxuICBcbiAgaWYgKGRiSW5zdGFuY2UpIHtcbiAgICBhd2FpdCBkYkluc3RhbmNlLmNsb3NlKCk7XG4gICAgZGJJbnN0YW5jZSA9IG51bGw7XG4gIH1cbn0gIl0sIm5hbWVzIjpbImlzU2VydmVyIiwiZG9lc0RCRmlsZUV4aXN0IiwiZnMiLCJwYXRoIiwiZGJQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJleGlzdHNTeW5jIiwiZXJyb3IiLCJjb25zb2xlIiwiaXNGaXJzdEluaXRpYWxpemF0aW9uIiwiaW5pdGlhbGl6ZURCIiwiRXJyb3IiLCJkYkZpbGVFeGlzdGVkIiwib3BlbiIsInNxbGl0ZTMiLCJiY3J5cHQiLCJ1cmwiLCJfX2ZpbGVuYW1lIiwiZmlsZVVSTFRvUGF0aCIsIl9fZGlybmFtZSIsImRpcm5hbWUiLCJEQl9QQVRIIiwibG9nIiwiZGIiLCJmaWxlbmFtZSIsImRyaXZlciIsImRlZmF1bHQiLCJEYXRhYmFzZSIsImV4ZWMiLCJ0YWJsZUluZm8iLCJhbGwiLCJkb2N1bWVudENvbHVtbkV4aXN0cyIsInNvbWUiLCJjb2x1bW4iLCJuYW1lIiwiYWRtaW5Vc2VyIiwiZ2V0IiwiaGFzaGVkUGFzc3dvcmQiLCJoYXNoIiwicnVuIiwiY2F0ZWdvcmllc0NvdW50IiwiY291bnQiLCJkZWZhdWx0Q2F0ZWdvcmllcyIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcnkiLCJwcm9kdWN0c0NvdW50IiwicHJvZHVjdHNKc29uUGF0aCIsInByb2R1Y3RzIiwicHJvZHVjdHNKc29uIiwicmVhZEZpbGVTeW5jIiwiSlNPTiIsInBhcnNlIiwiaWQiLCJpbWFnZSIsInNwZWNzIiwidXNlQ2FzZXMiLCJwcm9kdWN0Iiwic3RyaW5naWZ5IiwibGVuZ3RoIiwiam9iT3BlbmluZ3NDb3VudCIsImRlZmF1bHRKb2JzIiwidGl0bGUiLCJkZXBhcnRtZW50IiwibG9jYXRpb24iLCJ0eXBlIiwiam9iIiwiZGJJbnN0YW5jZSIsImdldERCIiwiY2xvc2VEQiIsImNsb3NlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fauth&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fauth.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();