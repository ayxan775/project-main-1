"use strict";(()=>{var e={};e.id=35,e.ids=[35],e.modules={8432:e=>{e.exports=require("bcryptjs")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},661:e=>{e.exports=require("sqlite3")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},7360:e=>{e.exports=require("url")},8887:e=>{e.exports=import("sqlite")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},5280:(e,t,a)=>{a.r(t),a.d(t,{config:()=>d,default:()=>c,routeModule:()=>u});var n={};a.r(n),a.d(n,{default:()=>l});var o=a(1802),i=a(7153),r=a(6249),s=a(2250);async function l(e,t){try{let a=await (0,s.VK)();if("GET"===e.method){let n="true"===e.query.active;console.log("GET /api/job-openings - activeOnly:",n),console.log("Query parameters:",e.query);let o="SELECT * FROM job_openings";n&&(o+=" WHERE active = 1"),o+=" ORDER BY created_at DESC",console.log("Executing SQL:",o);try{let e=await a.all(o);return console.log(`Found ${e.length} job openings:`,e),t.status(200).json(e)}catch(e){return console.error("Database query error:",e),t.status(500).json({message:"Database query failed",error:e.message})}}if("POST"===e.method){let n=e.headers.authorization;if(!n||!n.startsWith("Bearer "))return t.status(401).json({message:"Unauthorized"});let{title:o,department:i,location:r,type:s,description:l}=e.body;if(!o||!r||!s||!l)return t.status(400).json({message:"Required fields are missing"});let c=void 0===e.body.active||e.body.active,d=await a.run("INSERT INTO job_openings (title, department, location, type, description, active) VALUES (?, ?, ?, ?, ?, ?)",[o,i||"general",r,s,l,c?1:0]);return t.status(201).json({id:d.lastID,message:"Job opening created successfully"})}if("PUT"===e.method){let n=e.headers.authorization;if(!n||!n.startsWith("Bearer "))return t.status(401).json({message:"Unauthorized"});let{id:o,title:i,department:r,location:s,type:l,description:c,active:d}=e.body;if(!o||!i||!s||!l||!c)return t.status(400).json({message:"Required fields are missing"});let u=d?1:0;return console.log("Updating job opening:",{id:o,title:i,department:r,location:s,type:l,description:c,active:d,activeValue:u}),await a.run("UPDATE job_openings SET title = ?, department = ?, location = ?, type = ?, description = ?, active = ? WHERE id = ?",[i,r||"general",s,l,c,u,o]),t.status(200).json({message:"Job opening updated successfully"})}if("DELETE"===e.method){let n=e.headers.authorization;if(!n||!n.startsWith("Bearer "))return t.status(401).json({message:"Unauthorized"});let{id:o}=e.query;if(!o)return t.status(400).json({message:"Job opening ID is required"});try{if(await a.run("BEGIN TRANSACTION"),!await a.get("SELECT * FROM job_openings WHERE id = ?",[o]))return await a.run("ROLLBACK"),t.status(404).json({message:"Job opening not found"});let e=await a.run("DELETE FROM job_openings WHERE id = ?",[o]);if(0===e.changes)return await a.run("ROLLBACK"),t.status(400).json({message:"Failed to delete job opening"});return await a.run("COMMIT"),t.status(200).json({message:"Job opening deleted successfully",deletedId:o})}catch(e){return await a.run("ROLLBACK"),console.error("Error deleting job opening:",e),t.status(500).json({message:"Failed to delete job opening",error:e instanceof Error?e.message:"Unknown error"})}}return t.status(405).json({message:"Method not allowed"})}catch(e){return console.error("Error handling job openings:",e),t.status(500).json({message:"Internal server error"})}}let c=(0,r.l)(n,"default"),d=(0,r.l)(n,"config"),u=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/job-openings",pathname:"/api/job-openings",bundlePath:"",filename:""},userland:n})},2250:(e,t,a)=>{a.d(t,{VK:()=>s,u1:()=>i});let n=async()=>{try{let e=await Promise.resolve().then(a.t.bind(a,2048,23)),t=(await Promise.resolve().then(a.t.bind(a,5315,23))).join(process.cwd(),"data.db");return e.existsSync(t)}catch(e){return console.error("Error checking if DB file exists:",e),!1}},o=!0;async function i(){try{let e=await n(),{open:t}=await Promise.resolve().then(a.bind(a,8887)),i=await Promise.resolve().then(a.t.bind(a,661,23)),s=await Promise.resolve().then(a.t.bind(a,8432,23)),l=await Promise.resolve().then(a.t.bind(a,5315,23)),c=await Promise.resolve().then(a.t.bind(a,7360,23));await Promise.resolve().then(a.t.bind(a,2048,23));let d=c.fileURLToPath("file:///home/user456/Documents/project-main-1/src/lib/db.ts");l.dirname(d);let u=l.join(process.cwd(),"data.db");console.log("Initializing database at:",u);let E=await t({filename:u,driver:i.default.Database});console.log("Connected to database"),await E.exec(`
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        username TEXT UNIQUE NOT NULL,
        password TEXT NOT NULL,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      );

      CREATE TABLE IF NOT EXISTS categories (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT UNIQUE NOT NULL,
        description TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
      );

      CREATE TABLE IF NOT EXISTS products (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        description TEXT,
        image TEXT,
        specs TEXT,
        useCases TEXT,
        category TEXT,
        images TEXT,
        document TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (category) REFERENCES categories(name)
      );
      
      CREATE TABLE IF NOT EXISTS job_openings (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        department TEXT NOT NULL,
        location TEXT NOT NULL,
        type TEXT NOT NULL,
        description TEXT NOT NULL,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
        active INTEGER DEFAULT 1
      );
    `),console.log("Database tables created");try{(await E.all("PRAGMA table_info(products)")).some(e=>"document"===e.name)||(await E.exec("ALTER TABLE products ADD COLUMN document TEXT"),console.log("Added document column to products table"))}catch(e){console.error("Error altering products table:",e)}if(!await E.get("SELECT * FROM users WHERE username = ?",["admin"])){let e=await s.hash("Azerbaycan123",10);await E.run("INSERT INTO users (username, password) VALUES (?, ?)",["admin",e]),console.log("Admin user created")}let p=await E.get("SELECT COUNT(*) as count FROM categories");if(0===p.count)for(let e of[{name:"Industrial Equipment",description:"Heavy-duty industrial machinery and equipment"},{name:"Safety Gear",description:"Personal protective equipment and safety solutions"},{name:"Measurement Tools",description:"Precision measurement and testing instruments"},{name:"Fluid Control",description:"Valves, pumps, and fluid management systems"},{name:"Power Systems",description:"Power generation and electrical equipment"},{name:"Construction Equipment",description:"Tools and equipment for construction projects"}])await E.run("INSERT INTO categories (name, description) VALUES (?, ?)",[e.name,e.description]);let T=await E.get("SELECT COUNT(*) as count FROM products");if(0===T.count&&!e&&o)try{let e=await Promise.resolve().then(a.t.bind(a,2048,23)),t=(await Promise.resolve().then(a.t.bind(a,5315,23))).join(process.cwd(),"src","data","products.json"),n=[];if(e.existsSync(t)){let a=e.readFileSync(t,"utf8");n=JSON.parse(a),console.log("Loaded products from JSON file")}else n=[{id:1,name:"Sample Product",description:"A sample product created automatically",image:"https://placehold.co/600x400?text=Sample+Product",specs:["Sample specification 1","Sample specification 2"],useCases:["Sample use case 1","Sample use case 2"],category:"Sample Category"}],console.log("Using default product as fallback");for(let e of n)await E.run("INSERT INTO products (id, name, description, image, specs, useCases, category) VALUES (?, ?, ?, ?, ?, ?, ?)",[e.id,e.name,e.description,e.image,JSON.stringify(e.specs),JSON.stringify(e.useCases),e.category]);console.log(`${n.length} products inserted into database`)}catch(e){console.error("Error importing initial products:",e)}o=!1;let m=await E.get("SELECT COUNT(*) as count FROM job_openings");if(0===m.count){for(let e of[{title:"Supply Chain Manager",department:"operations",location:"Baku, Azerbaijan",type:"Full-time",description:"Leading and optimizing supply chain operations..."},{title:"Sales Representative",department:"sales",location:"Baku, Azerbaijan",type:"Full-time",description:"Developing and maintaining client relationships..."},{title:"Logistics Coordinator",department:"logistics",location:"Baku, Azerbaijan",type:"Full-time",description:"Coordinating shipment schedules and delivery routes..."}])await E.run("INSERT INTO job_openings (title, department, location, type, description) VALUES (?, ?, ?, ?, ?)",[e.title,e.department,e.location,e.type,e.description]);console.log("Default job openings created")}return r=E,E}catch(e){throw console.error("Database initialization error:",e),e}}let r=null;async function s(){return r||(r=await i()),r}},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=5280);module.exports=a})();