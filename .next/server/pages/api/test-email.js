"use strict";(()=>{var e={};e.id=863,e.ids=[863],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},6624:e=>{e.exports=require("querystring")},9648:e=>{e.exports=import("axios")},6705:e=>{e.exports=import("formidable")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},1378:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>p,default:()=>c,routeModule:()=>u});var o=s(1802),n=s(7153),a=s(6249),i=s(7119),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,a.l)(i,"default"),p=(0,a.l)(i,"config"),u=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/test-email",pathname:"/api/test-email",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},7119:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>m,default:()=>u});var o=s(9648),n=s(6624),a=s.n(n),i=s(2048),l=s.n(i),c=s(6705),p=e([o,c]);[o,c]=p.then?(await p)():p;let m={api:{bodyParser:!1}},d=async e=>new Promise((t,s)=>{new c.IncomingForm({maxFileSize:5242880}).parse(e,(e,r,o)=>{e&&s(e),t({fields:r,files:o})})});async function u(e,t){if("POST"!==e.method)return t.setHeader("Allow",["POST"]),t.status(405).end(`Method ${e.method} Not Allowed`);try{let s;let{fields:r,files:n}=await d(e),i=process.env.OAUTH_CLIENT_ID,c=process.env.OAUTH_CLIENT_SECRET,p=process.env.OAUTH_TENANT_ID,u=process.env.OAUTH_USER_EMAIL,m=process.env.CONTACT_FORM_RECEIVER_EMAIL;if(!i||!c||!p||!u||!m)return t.status(500).json({error:"Configuration error",details:"Email credentials not properly configured"});if(n.testFile&&Array.isArray(n.testFile)&&n.testFile[0]){let e=n.testFile[0];if(e.size>5242880)return t.status(400).json({error:"File size exceeds the 5MB limit."});let r=l().readFileSync(e.filepath).toString("base64");s={fileName:e.originalFilename||"test-attachment",content:r,contentType:e.mimetype||"application/octet-stream"}}let f="";try{console.log("Attempting to fetch OAuth2 access token for test email...");let e=`https://login.microsoftonline.com/${p}/oauth2/v2.0/token`;f=(await o.default.post(e,a().stringify({client_id:i,client_secret:c,scope:"https://graph.microsoft.com/.default",grant_type:"client_credentials"}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data.access_token,console.log("Successfully fetched OAuth2 access token for test email."),console.log("Sending test email via Microsoft Graph API...");let r={message:{subject:"Test Email from App",body:{contentType:"HTML",content:"<p>This is a test email sent from the application to verify email functionality.</p>"},toRecipients:[{emailAddress:{address:m}}]},saveToSentItems:!1};return s&&(r.message.attachments=[{"@odata.type":"#microsoft.graph.fileAttachment",name:s.fileName,contentType:s.contentType,contentBytes:s.content}],console.log("Adding attachment to test email:",s.fileName)),await o.default.post("https://graph.microsoft.com/v1.0/users/"+u+"/sendMail",r,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"}}),console.log("Test email sent successfully via Graph API!"),t.status(200).json({success:!0,message:"Test email sent!"})}catch(e){return console.error("Test email error:"),e.response?(console.error("Status:",e.response.status),console.error("Data:",JSON.stringify(e.response.data,null,2))):console.error(e),t.status(500).json({error:"Failed to send test email",details:e.response?`API Error: ${e.response.status} - ${JSON.stringify(e.response.data)}`:e instanceof Error?e.message:String(e)})}}catch(e){return console.error("Form parsing error:",e),t.status(500).json({error:"Failed to process form data",details:e instanceof Error?e.message:String(e)})}}r()}catch(e){r(e)}})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=1378);module.exports=s})();