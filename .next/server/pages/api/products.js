"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/products";
exports.ids = ["pages/api/products"];
exports.modules = {

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "sqlite3":
/*!**************************!*\
  !*** external "sqlite3" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("sqlite3");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "sqlite":
/*!*************************!*\
  !*** external "sqlite" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("sqlite");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_products_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/products.ts */ \"(api)/./pages/api/products.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_products_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_products_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/products\",\n        pathname: \"/api/products\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_products_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnByb2R1Y3RzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlMkZhcGklMkZwcm9kdWN0cy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNvRDtBQUNwRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsbURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG1EQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL3ZpdGUtcmVhY3QtdHlwZXNjcmlwdC1zdGFydGVyLz9hY2FjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvcHJvZHVjdHMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9wcm9kdWN0c1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3Byb2R1Y3RzXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/products.ts":
/*!*******************************!*\
  !*** ./pages/api/products.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _src_lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/lib/db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-secret-key\";\n// More reliable way to check if DB is initialized by checking for the actual file\nconst isDBInitialized = ()=>{\n    try {\n        const dbPath = path__WEBPACK_IMPORTED_MODULE_3__.join(process.cwd(), \"data.db\");\n        return fs__WEBPACK_IMPORTED_MODULE_2__.existsSync(dbPath);\n    } catch (error) {\n        console.error(\"Error checking DB file:\", error);\n        return false;\n    }\n};\n// Middleware to verify JWT token\nconst verifyToken = (req)=>{\n    return new Promise((resolve, reject)=>{\n        const authHeader = req.headers.authorization;\n        if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n            reject(new Error(\"Unauthorized\"));\n            return;\n        }\n        const token = authHeader.split(\" \")[1];\n        jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, JWT_SECRET, (err, decoded)=>{\n            if (err) {\n                reject(new Error(\"Unauthorized\"));\n                return;\n            }\n            resolve(decoded);\n        });\n    });\n};\nconst config = {\n    api: {\n        bodyParser: {\n            sizeLimit: \"10mb\"\n        }\n    }\n};\nasync function handler(req, res) {\n    // Set proper JSON content type\n    res.setHeader(\"Content-Type\", \"application/json\");\n    // Handle preflight OPTIONS request for CORS\n    if (req.method === \"OPTIONS\") {\n        return res.status(200).end();\n    }\n    try {\n        // Initialize database if needed\n        if (!isDBInitialized()) {\n            try {\n                await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_1__.initializeDB)();\n                console.log(\"DB initialized in products API\");\n            } catch (dbError) {\n                console.error(\"Failed to initialize database:\", dbError);\n                return res.status(500).json({\n                    message: \"Database initialization failed\",\n                    error: dbError instanceof Error ? dbError.message : String(dbError)\n                });\n            }\n        }\n        // Handle GET method without authentication for public product listing\n        if (req.method === \"GET\" && !req.query.id) {\n            const db = await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_1__.getDB)();\n            const products = await db.all(\"SELECT * FROM products\");\n            // Parse JSON strings back to arrays\n            const formattedProducts = products.map((product)=>({\n                    ...product,\n                    specs: JSON.parse(product.specs || \"[]\"),\n                    useCases: JSON.parse(product.useCases || \"[]\"),\n                    images: JSON.parse(product.images || \"[]\")\n                }));\n            return res.status(200).json(formattedProducts);\n        }\n        // Handle GET method for a single product\n        if (req.method === \"GET\" && req.query.id) {\n            const db = await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_1__.getDB)();\n            const product = await db.get(\"SELECT * FROM products WHERE id = ?\", [\n                req.query.id\n            ]);\n            if (!product) {\n                return res.status(404).json({\n                    message: \"Product not found\"\n                });\n            }\n            // Parse JSON strings back to arrays\n            const formattedProduct = {\n                ...product,\n                specs: JSON.parse(product.specs || \"[]\"),\n                useCases: JSON.parse(product.useCases || \"[]\"),\n                images: JSON.parse(product.images || \"[]\")\n            };\n            return res.status(200).json(formattedProduct);\n        }\n        // All other methods require authentication\n        try {\n            await verifyToken(req);\n        } catch (error) {\n            return res.status(401).json({\n                message: \"Unauthorized\"\n            });\n        }\n        // Handle POST method (create)\n        if (req.method === \"POST\") {\n            const { name, description, image, specs, useCases, category, images, document } = req.body;\n            if (!name) {\n                return res.status(400).json({\n                    message: \"Product name is required\"\n                });\n            }\n            const db = await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_1__.getDB)();\n            const result = await db.run(\"INSERT INTO products (name, description, image, specs, useCases, category, images, document) VALUES (?, ?, ?, ?, ?, ?, ?, ?)\", [\n                name,\n                description || \"\",\n                image || \"\",\n                JSON.stringify(specs || []),\n                JSON.stringify(useCases || []),\n                category || \"\",\n                JSON.stringify(images || []),\n                document || \"\"\n            ]);\n            const newProduct = await db.get(\"SELECT * FROM products WHERE id = ?\", [\n                result.lastID\n            ]);\n            return res.status(201).json({\n                ...newProduct,\n                specs: JSON.parse(newProduct.specs || \"[]\"),\n                useCases: JSON.parse(newProduct.useCases || \"[]\"),\n                images: JSON.parse(newProduct.images || \"[]\")\n            });\n        }\n        // Handle PUT method (update)\n        if (req.method === \"PUT\" && req.query.id) {\n            const { name, description, image, specs, useCases, category, images, document } = req.body;\n            if (!name) {\n                return res.status(400).json({\n                    message: \"Product name is required\"\n                });\n            }\n            const db = await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_1__.getDB)();\n            // Validate that the category exists if one is provided\n            if (category) {\n                const categoryExists = await db.get(\"SELECT 1 FROM categories WHERE name = ?\", [\n                    category\n                ]);\n                if (!categoryExists) {\n                    return res.status(400).json({\n                        message: \"Selected category does not exist\"\n                    });\n                }\n            }\n            await db.run(\"UPDATE products SET name = ?, description = ?, image = ?, specs = ?, useCases = ?, category = ?, images = ?, document = ? WHERE id = ?\", [\n                name,\n                description || \"\",\n                image || \"\",\n                JSON.stringify(specs || []),\n                JSON.stringify(useCases || []),\n                category || \"\",\n                JSON.stringify(images || []),\n                document || \"\",\n                req.query.id\n            ]);\n            const updatedProduct = await db.get(\"SELECT * FROM products WHERE id = ?\", [\n                req.query.id\n            ]);\n            if (!updatedProduct) {\n                return res.status(404).json({\n                    message: \"Product not found\"\n                });\n            }\n            return res.status(200).json({\n                ...updatedProduct,\n                specs: JSON.parse(updatedProduct.specs || \"[]\"),\n                useCases: JSON.parse(updatedProduct.useCases || \"[]\"),\n                images: JSON.parse(updatedProduct.images || \"[]\")\n            });\n        }\n        // Handle DELETE method\n        if (req.method === \"DELETE\" && req.query.id) {\n            const db = await (0,_src_lib_db__WEBPACK_IMPORTED_MODULE_1__.getDB)();\n            const product = await db.get(\"SELECT * FROM products WHERE id = ?\", [\n                req.query.id\n            ]);\n            if (!product) {\n                return res.status(404).json({\n                    message: \"Product not found\"\n                });\n            }\n            await db.run(\"DELETE FROM products WHERE id = ?\", [\n                req.query.id\n            ]);\n            return res.status(200).json({\n                message: \"Product deleted successfully\"\n            });\n        }\n        // Handle unsupported methods\n        return res.status(405).json({\n            message: \"Method not allowed\"\n        });\n    } catch (error) {\n        console.error(\"Products API error:\", error);\n        return res.status(500).json({\n            message: \"Internal server error\"\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0ksSUFBSSxDQUFDO29CQUFFQyxTQUFTO2dCQUFvQjtZQUM3RDtZQUVBLE1BQU1JLEdBQUdvQixHQUFHLENBQUMscUNBQXFDO2dCQUFDbkQsSUFBSTZCLEtBQUssQ0FBQ0MsRUFBRTthQUFDO1lBRWhFLE9BQU9YLElBQUlHLE1BQU0sQ0FBQyxLQUFLSSxJQUFJLENBQUM7Z0JBQUVDLFNBQVM7WUFBK0I7UUFDeEU7UUFFQSw2QkFBNkI7UUFDN0IsT0FBT1IsSUFBSUcsTUFBTSxDQUFDLEtBQUtJLElBQUksQ0FBQztZQUFFQyxTQUFTO1FBQXFCO0lBQzlELEVBQUUsT0FBTzlCLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLHVCQUF1QkE7UUFDckMsT0FBT3NCLElBQUlHLE1BQU0sQ0FBQyxLQUFLSSxJQUFJLENBQUM7WUFBRUMsU0FBUztRQUF3QjtJQUNqRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdml0ZS1yZWFjdC10eXBlc2NyaXB0LXN0YXJ0ZXIvLi9wYWdlcy9hcGkvcHJvZHVjdHMudHM/MzUxNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgeyBnZXREQiwgaW5pdGlhbGl6ZURCIH0gZnJvbSAnLi4vLi4vc3JjL2xpYi9kYic7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5jb25zdCBKV1RfU0VDUkVUID0gcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAneW91ci1zZWNyZXQta2V5JztcblxuLy8gTW9yZSByZWxpYWJsZSB3YXkgdG8gY2hlY2sgaWYgREIgaXMgaW5pdGlhbGl6ZWQgYnkgY2hlY2tpbmcgZm9yIHRoZSBhY3R1YWwgZmlsZVxuY29uc3QgaXNEQkluaXRpYWxpemVkID0gKCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YS5kYicpO1xuICAgIHJldHVybiBmcy5leGlzdHNTeW5jKGRiUGF0aCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgREIgZmlsZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vLyBNaWRkbGV3YXJlIHRvIHZlcmlmeSBKV1QgdG9rZW5cbmNvbnN0IHZlcmlmeVRva2VuID0gKHJlcTogTmV4dEFwaVJlcXVlc3QpOiBQcm9taXNlPGFueT4gPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICAgIFxuICAgIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcbiAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1VuYXV0aG9yaXplZCcpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXTtcbiAgICBcbiAgICBqd3QudmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVULCAoZXJyLCBkZWNvZGVkKSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1VuYXV0aG9yaXplZCcpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmVzb2x2ZShkZWNvZGVkKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBhcGk6IHtcbiAgICBib2R5UGFyc2VyOiB7XG4gICAgICBzaXplTGltaXQ6ICcxMG1iJ1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICAvLyBTZXQgcHJvcGVyIEpTT04gY29udGVudCB0eXBlXG4gIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gIFxuICAvLyBIYW5kbGUgcHJlZmxpZ2h0IE9QVElPTlMgcmVxdWVzdCBmb3IgQ09SU1xuICBpZiAocmVxLm1ldGhvZCA9PT0gJ09QVElPTlMnKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5lbmQoKTtcbiAgfVxuICBcbiAgdHJ5IHtcbiAgICAvLyBJbml0aWFsaXplIGRhdGFiYXNlIGlmIG5lZWRlZFxuICAgIGlmICghaXNEQkluaXRpYWxpemVkKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGluaXRpYWxpemVEQigpO1xuICAgICAgICBjb25zb2xlLmxvZygnREIgaW5pdGlhbGl6ZWQgaW4gcHJvZHVjdHMgQVBJJyk7XG4gICAgICB9IGNhdGNoIChkYkVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIGRhdGFiYXNlOicsIGRiRXJyb3IpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgICAgICBtZXNzYWdlOiAnRGF0YWJhc2UgaW5pdGlhbGl6YXRpb24gZmFpbGVkJyxcbiAgICAgICAgICBlcnJvcjogZGJFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZGJFcnJvci5tZXNzYWdlIDogU3RyaW5nKGRiRXJyb3IpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgR0VUIG1ldGhvZCB3aXRob3V0IGF1dGhlbnRpY2F0aW9uIGZvciBwdWJsaWMgcHJvZHVjdCBsaXN0aW5nXG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnICYmICFyZXEucXVlcnkuaWQpIHtcbiAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcbiAgICAgIGNvbnN0IHByb2R1Y3RzID0gYXdhaXQgZGIuYWxsKCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzJyk7XG4gICAgICBcbiAgICAgIC8vIFBhcnNlIEpTT04gc3RyaW5ncyBiYWNrIHRvIGFycmF5c1xuICAgICAgY29uc3QgZm9ybWF0dGVkUHJvZHVjdHMgPSBwcm9kdWN0cy5tYXAoKHByb2R1Y3Q6IGFueSkgPT4gKHtcbiAgICAgICAgLi4ucHJvZHVjdCxcbiAgICAgICAgc3BlY3M6IEpTT04ucGFyc2UocHJvZHVjdC5zcGVjcyB8fCAnW10nKSxcbiAgICAgICAgdXNlQ2FzZXM6IEpTT04ucGFyc2UocHJvZHVjdC51c2VDYXNlcyB8fCAnW10nKSxcbiAgICAgICAgaW1hZ2VzOiBKU09OLnBhcnNlKHByb2R1Y3QuaW1hZ2VzIHx8ICdbXScpXG4gICAgICB9KSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihmb3JtYXR0ZWRQcm9kdWN0cyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBHRVQgbWV0aG9kIGZvciBhIHNpbmdsZSBwcm9kdWN0XG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdHRVQnICYmIHJlcS5xdWVyeS5pZCkge1xuICAgICAgY29uc3QgZGIgPSBhd2FpdCBnZXREQigpO1xuICAgICAgY29uc3QgcHJvZHVjdCA9IGF3YWl0IGRiLmdldCgnU0VMRUNUICogRlJPTSBwcm9kdWN0cyBXSEVSRSBpZCA9ID8nLCBbcmVxLnF1ZXJ5LmlkXSk7XG4gICAgICBcbiAgICAgIGlmICghcHJvZHVjdCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnUHJvZHVjdCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBQYXJzZSBKU09OIHN0cmluZ3MgYmFjayB0byBhcnJheXNcbiAgICAgIGNvbnN0IGZvcm1hdHRlZFByb2R1Y3QgPSB7XG4gICAgICAgIC4uLnByb2R1Y3QsXG4gICAgICAgIHNwZWNzOiBKU09OLnBhcnNlKHByb2R1Y3Quc3BlY3MgfHwgJ1tdJyksXG4gICAgICAgIHVzZUNhc2VzOiBKU09OLnBhcnNlKHByb2R1Y3QudXNlQ2FzZXMgfHwgJ1tdJyksXG4gICAgICAgIGltYWdlczogSlNPTi5wYXJzZShwcm9kdWN0LmltYWdlcyB8fCAnW10nKVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKGZvcm1hdHRlZFByb2R1Y3QpO1xuICAgIH1cbiAgICBcbiAgICAvLyBBbGwgb3RoZXIgbWV0aG9kcyByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHZlcmlmeVRva2VuKHJlcSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdVbmF1dGhvcml6ZWQnIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgUE9TVCBtZXRob2QgKGNyZWF0ZSlcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XG4gICAgICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZSwgc3BlY3MsIHVzZUNhc2VzLCBjYXRlZ29yeSwgaW1hZ2VzLCBkb2N1bWVudCB9ID0gcmVxLmJvZHk7XG4gICAgICBcbiAgICAgIGlmICghbmFtZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnUHJvZHVjdCBuYW1lIGlzIHJlcXVpcmVkJyB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgZGIgPSBhd2FpdCBnZXREQigpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIucnVuKFxuICAgICAgICAnSU5TRVJUIElOVE8gcHJvZHVjdHMgKG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZSwgc3BlY3MsIHVzZUNhc2VzLCBjYXRlZ29yeSwgaW1hZ2VzLCBkb2N1bWVudCkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/LCA/KScsXG4gICAgICAgIFtcbiAgICAgICAgICBuYW1lLFxuICAgICAgICAgIGRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgICAgIGltYWdlIHx8ICcnLFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHNwZWNzIHx8IFtdKSxcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh1c2VDYXNlcyB8fCBbXSksXG4gICAgICAgICAgY2F0ZWdvcnkgfHwgJycsXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoaW1hZ2VzIHx8IFtdKSxcbiAgICAgICAgICBkb2N1bWVudCB8fCAnJ1xuICAgICAgICBdXG4gICAgICApO1xuICAgICAgXG4gICAgICBjb25zdCBuZXdQcm9kdWN0ID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gPycsIFtyZXN1bHQubGFzdElEXSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIC4uLm5ld1Byb2R1Y3QsXG4gICAgICAgIHNwZWNzOiBKU09OLnBhcnNlKG5ld1Byb2R1Y3Quc3BlY3MgfHwgJ1tdJyksXG4gICAgICAgIHVzZUNhc2VzOiBKU09OLnBhcnNlKG5ld1Byb2R1Y3QudXNlQ2FzZXMgfHwgJ1tdJyksXG4gICAgICAgIGltYWdlczogSlNPTi5wYXJzZShuZXdQcm9kdWN0LmltYWdlcyB8fCAnW10nKVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBQVVQgbWV0aG9kICh1cGRhdGUpXG4gICAgaWYgKHJlcS5tZXRob2QgPT09ICdQVVQnICYmIHJlcS5xdWVyeS5pZCkge1xuICAgICAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiwgaW1hZ2UsIHNwZWNzLCB1c2VDYXNlcywgY2F0ZWdvcnksIGltYWdlcywgZG9jdW1lbnQgfSA9IHJlcS5ib2R5O1xuICAgICAgXG4gICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ1Byb2R1Y3QgbmFtZSBpcyByZXF1aXJlZCcgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgdGhhdCB0aGUgY2F0ZWdvcnkgZXhpc3RzIGlmIG9uZSBpcyBwcm92aWRlZFxuICAgICAgaWYgKGNhdGVnb3J5KSB7XG4gICAgICAgIGNvbnN0IGNhdGVnb3J5RXhpc3RzID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgMSBGUk9NIGNhdGVnb3JpZXMgV0hFUkUgbmFtZSA9ID8nLCBbY2F0ZWdvcnldKTtcbiAgICAgICAgaWYgKCFjYXRlZ29yeUV4aXN0cykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdTZWxlY3RlZCBjYXRlZ29yeSBkb2VzIG5vdCBleGlzdCcgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAnVVBEQVRFIHByb2R1Y3RzIFNFVCBuYW1lID0gPywgZGVzY3JpcHRpb24gPSA/LCBpbWFnZSA9ID8sIHNwZWNzID0gPywgdXNlQ2FzZXMgPSA/LCBjYXRlZ29yeSA9ID8sIGltYWdlcyA9ID8sIGRvY3VtZW50ID0gPyBXSEVSRSBpZCA9ID8nLFxuICAgICAgICBbXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgICAgICBpbWFnZSB8fCAnJyxcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeShzcGVjcyB8fCBbXSksXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkodXNlQ2FzZXMgfHwgW10pLFxuICAgICAgICAgIGNhdGVnb3J5IHx8ICcnLFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGltYWdlcyB8fCBbXSksXG4gICAgICAgICAgZG9jdW1lbnQgfHwgJycsXG4gICAgICAgICAgcmVxLnF1ZXJ5LmlkXG4gICAgICAgIF1cbiAgICAgICk7XG4gICAgICBcbiAgICAgIGNvbnN0IHVwZGF0ZWRQcm9kdWN0ID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gPycsIFtyZXEucXVlcnkuaWRdKTtcbiAgICAgIFxuICAgICAgaWYgKCF1cGRhdGVkUHJvZHVjdCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnUHJvZHVjdCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICAuLi51cGRhdGVkUHJvZHVjdCxcbiAgICAgICAgc3BlY3M6IEpTT04ucGFyc2UodXBkYXRlZFByb2R1Y3Quc3BlY3MgfHwgJ1tdJyksXG4gICAgICAgIHVzZUNhc2VzOiBKU09OLnBhcnNlKHVwZGF0ZWRQcm9kdWN0LnVzZUNhc2VzIHx8ICdbXScpLFxuICAgICAgICBpbWFnZXM6IEpTT04ucGFyc2UodXBkYXRlZFByb2R1Y3QuaW1hZ2VzIHx8ICdbXScpXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIERFTEVURSBtZXRob2RcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0RFTEVURScgJiYgcmVxLnF1ZXJ5LmlkKSB7XG4gICAgICBjb25zdCBkYiA9IGF3YWl0IGdldERCKCk7XG4gICAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgKiBGUk9NIHByb2R1Y3RzIFdIRVJFIGlkID0gPycsIFtyZXEucXVlcnkuaWRdKTtcbiAgICAgIFxuICAgICAgaWYgKCFwcm9kdWN0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdQcm9kdWN0IG5vdCBmb3VuZCcgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGF3YWl0IGRiLnJ1bignREVMRVRFIEZST00gcHJvZHVjdHMgV0hFUkUgaWQgPSA/JywgW3JlcS5xdWVyeS5pZF0pO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBtZXNzYWdlOiAnUHJvZHVjdCBkZWxldGVkIHN1Y2Nlc3NmdWxseScgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSB1bnN1cHBvcnRlZCBtZXRob2RzXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgbWVzc2FnZTogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignUHJvZHVjdHMgQVBJIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyB9KTtcbiAgfVxufSAiXSwibmFtZXMiOlsiand0IiwiZ2V0REIiLCJpbml0aWFsaXplREIiLCJmcyIsInBhdGgiLCJKV1RfU0VDUkVUIiwicHJvY2VzcyIsImVudiIsImlzREJJbml0aWFsaXplZCIsImRiUGF0aCIsImpvaW4iLCJjd2QiLCJleGlzdHNTeW5jIiwiZXJyb3IiLCJjb25zb2xlIiwidmVyaWZ5VG9rZW4iLCJyZXEiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImF1dGhIZWFkZXIiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInN0YXJ0c1dpdGgiLCJFcnJvciIsInRva2VuIiwic3BsaXQiLCJ2ZXJpZnkiLCJlcnIiLCJkZWNvZGVkIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciIsInNpemVMaW1pdCIsImhhbmRsZXIiLCJyZXMiLCJzZXRIZWFkZXIiLCJtZXRob2QiLCJzdGF0dXMiLCJlbmQiLCJsb2ciLCJkYkVycm9yIiwianNvbiIsIm1lc3NhZ2UiLCJTdHJpbmciLCJxdWVyeSIsImlkIiwiZGIiLCJwcm9kdWN0cyIsImFsbCIsImZvcm1hdHRlZFByb2R1Y3RzIiwibWFwIiwicHJvZHVjdCIsInNwZWNzIiwiSlNPTiIsInBhcnNlIiwidXNlQ2FzZXMiLCJpbWFnZXMiLCJnZXQiLCJmb3JtYXR0ZWRQcm9kdWN0IiwibmFtZSIsImRlc2NyaXB0aW9uIiwiaW1hZ2UiLCJjYXRlZ29yeSIsImRvY3VtZW50IiwiYm9keSIsInJlc3VsdCIsInJ1biIsInN0cmluZ2lmeSIsIm5ld1Byb2R1Y3QiLCJsYXN0SUQiLCJjYXRlZ29yeUV4aXN0cyIsInVwZGF0ZWRQcm9kdWN0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/products.ts\n");

/***/ }),

/***/ "(api)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   closeDB: () => (/* binding */ closeDB),\n/* harmony export */   getDB: () => (/* binding */ getDB),\n/* harmony export */   initializeDB: () => (/* binding */ initializeDB)\n/* harmony export */ });\n// Check if we're running on the server to avoid errors in the browser\nconst isServer = \"undefined\" === \"undefined\";\n// Check if database file exists\nconst doesDBFileExist = async ()=>{\n    if (!isServer) return false;\n    try {\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n        const dbPath = path.join(process.cwd(), \"data.db\");\n        return fs.existsSync(dbPath);\n    } catch (error) {\n        console.error(\"Error checking if DB file exists:\", error);\n        return false;\n    }\n};\n// Track if this is the first time initializing\nlet isFirstInitialization = true;\n// Initialize database\nasync function initializeDB() {\n    if (!isServer) {\n        throw new Error(\"Database operations can only be performed on the server\");\n    }\n    try {\n        // Check if this is the first time running or if the file exists\n        const dbFileExisted = await doesDBFileExist();\n        // Dynamic imports to avoid issues with client-side code\n        const { open } = await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! sqlite */ \"sqlite\"));\n        const sqlite3 = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! sqlite3 */ \"sqlite3\", 23));\n        const bcrypt = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! bcryptjs */ \"bcryptjs\", 23));\n        const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n        const url = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! url */ \"url\", 23));\n        const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n        // Setup paths\n        const __filename = url.fileURLToPath(\"file:///home/home/Documents/project-main-1/src/lib/db.ts\");\n        const __dirname = path.dirname(__filename);\n        const DB_PATH = path.join(process.cwd(), \"data.db\");\n        console.log(\"Initializing database at:\", DB_PATH);\n        const db = await open({\n            filename: DB_PATH,\n            driver: sqlite3.default.Database\n        });\n        console.log(\"Connected to database\");\n        // Create tables if they don't exist\n        await db.exec(`\n      CREATE TABLE IF NOT EXISTS users (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        username TEXT UNIQUE NOT NULL,\n        password TEXT NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      );\n\n      CREATE TABLE IF NOT EXISTS categories (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT UNIQUE NOT NULL,\n        description TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      );\n\n      CREATE TABLE IF NOT EXISTS products (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL,\n        description TEXT,\n        image TEXT,\n        specs TEXT,\n        useCases TEXT,\n        category TEXT,\n        images TEXT,\n        document TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (category) REFERENCES categories(name)\n      );\n      \n      CREATE TABLE IF NOT EXISTS job_openings (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        department TEXT NOT NULL,\n        location TEXT NOT NULL,\n        type TEXT NOT NULL,\n        description TEXT NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        active INTEGER DEFAULT 1\n      );\n    `);\n        console.log(\"Database tables created\");\n        // Alter existing products table to add document column if it doesn't exist\n        try {\n            // Check if the document column exists\n            const tableInfo = await db.all(\"PRAGMA table_info(products)\");\n            const documentColumnExists = tableInfo.some((column)=>column.name === \"document\");\n            if (!documentColumnExists) {\n                // Add document column to products table\n                await db.exec(\"ALTER TABLE products ADD COLUMN document TEXT\");\n                console.log(\"Added document column to products table\");\n            }\n        } catch (error) {\n            console.error(\"Error altering products table:\", error);\n        }\n        // Check if admin user exists, if not create it\n        const adminUser = await db.get(\"SELECT * FROM users WHERE username = ?\", [\n            \"admin\"\n        ]);\n        if (!adminUser) {\n            const hashedPassword = await bcrypt.hash(\"Azerbaycan123\", 10);\n            await db.run(\"INSERT INTO users (username, password) VALUES (?, ?)\", [\n                \"admin\",\n                hashedPassword\n            ]);\n            console.log(\"Admin user created\");\n        }\n        // Initialize default categories if none exist\n        const categoriesCount = await db.get(\"SELECT COUNT(*) as count FROM categories\");\n        if (categoriesCount.count === 0) {\n            const defaultCategories = [\n                {\n                    name: \"Industrial Equipment\",\n                    description: \"Heavy-duty industrial machinery and equipment\"\n                },\n                {\n                    name: \"Safety Gear\",\n                    description: \"Personal protective equipment and safety solutions\"\n                },\n                {\n                    name: \"Measurement Tools\",\n                    description: \"Precision measurement and testing instruments\"\n                },\n                {\n                    name: \"Fluid Control\",\n                    description: \"Valves, pumps, and fluid management systems\"\n                },\n                {\n                    name: \"Power Systems\",\n                    description: \"Power generation and electrical equipment\"\n                },\n                {\n                    name: \"Construction Equipment\",\n                    description: \"Tools and equipment for construction projects\"\n                }\n            ];\n            for (const category of defaultCategories){\n                await db.run(\"INSERT INTO categories (name, description) VALUES (?, ?)\", [\n                    category.name,\n                    category.description\n                ]);\n            }\n        }\n        // Only import initial products if this is a brand new database (file didn't exist before)\n        // and the products table is empty\n        const productsCount = await db.get(\"SELECT COUNT(*) as count FROM products\");\n        if (productsCount.count === 0 && !dbFileExisted && isFirstInitialization) {\n            try {\n                // Try to load products from JSON file\n                const fs = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! fs */ \"fs\", 23));\n                const path = await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! path */ \"path\", 23));\n                const productsJsonPath = path.join(process.cwd(), \"src\", \"data\", \"products.json\");\n                let products = [];\n                if (fs.existsSync(productsJsonPath)) {\n                    // Read JSON file\n                    const productsJson = fs.readFileSync(productsJsonPath, \"utf8\");\n                    products = JSON.parse(productsJson);\n                    console.log(\"Loaded products from JSON file\");\n                } else {\n                    // Fallback to default product\n                    products = [\n                        {\n                            id: 1,\n                            name: \"Sample Product\",\n                            description: \"A sample product created automatically\",\n                            image: \"https://placehold.co/600x400?text=Sample+Product\",\n                            specs: [\n                                \"Sample specification 1\",\n                                \"Sample specification 2\"\n                            ],\n                            useCases: [\n                                \"Sample use case 1\",\n                                \"Sample use case 2\"\n                            ],\n                            category: \"Sample Category\"\n                        }\n                    ];\n                    console.log(\"Using default product as fallback\");\n                }\n                // Insert products\n                for (const product of products){\n                    await db.run(\"INSERT INTO products (id, name, description, image, specs, useCases, category) VALUES (?, ?, ?, ?, ?, ?, ?)\", [\n                        product.id,\n                        product.name,\n                        product.description,\n                        product.image,\n                        JSON.stringify(product.specs),\n                        JSON.stringify(product.useCases),\n                        product.category\n                    ]);\n                }\n                console.log(`${products.length} products inserted into database`);\n            } catch (error) {\n                console.error(\"Error importing initial products:\", error);\n            }\n        }\n        // Mark that we've already initialized once\n        isFirstInitialization = false;\n        // Initialize default job openings if none exist\n        const jobOpeningsCount = await db.get(\"SELECT COUNT(*) as count FROM job_openings\");\n        if (jobOpeningsCount.count === 0) {\n            const defaultJobs = [\n                {\n                    title: \"Supply Chain Manager\",\n                    department: \"operations\",\n                    location: \"Baku, Azerbaijan\",\n                    type: \"Full-time\",\n                    description: \"Leading and optimizing supply chain operations...\"\n                },\n                {\n                    title: \"Sales Representative\",\n                    department: \"sales\",\n                    location: \"Baku, Azerbaijan\",\n                    type: \"Full-time\",\n                    description: \"Developing and maintaining client relationships...\"\n                },\n                {\n                    title: \"Logistics Coordinator\",\n                    department: \"logistics\",\n                    location: \"Baku, Azerbaijan\",\n                    type: \"Full-time\",\n                    description: \"Coordinating shipment schedules and delivery routes...\"\n                }\n            ];\n            for (const job of defaultJobs){\n                await db.run(\"INSERT INTO job_openings (title, department, location, type, description) VALUES (?, ?, ?, ?, ?)\", [\n                    job.title,\n                    job.department,\n                    job.location,\n                    job.type,\n                    job.description\n                ]);\n            }\n            console.log(\"Default job openings created\");\n        }\n        // Store the db instance in module state\n        dbInstance = db;\n        return db;\n    } catch (error) {\n        console.error(\"Database initialization error:\", error);\n        throw error;\n    }\n}\n// Get database instance\nlet dbInstance = null;\nasync function getDB() {\n    if (!isServer) {\n        throw new Error(\"Database operations can only be performed on the server\");\n    }\n    if (!dbInstance) {\n        dbInstance = await initializeDB();\n    }\n    return dbInstance;\n}\n// Close database connection\nasync function closeDB() {\n    if (!isServer) {\n        throw new Error(\"Database operations can only be performed on the server\");\n    }\n    if (dbInstance) {\n        await dbInstance.close();\n        dbInstance = null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUlILFVBQVU7b0JBQUVHLElBQUlGLFFBQVE7b0JBQUVFLElBQUlELElBQUk7b0JBQUVDLElBQUl0QixXQUFXO2lCQUFDO1lBRXhFO1lBQ0FuQyxRQUFRYyxHQUFHLENBQUM7UUFDZDtRQUVBLHdDQUF3QztRQUN4QzRDLGFBQWEzQztRQUNiLE9BQU9BO0lBQ1QsRUFBRSxPQUFPaEIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsa0NBQWtDQTtRQUNoRCxNQUFNQTtJQUNSO0FBQ0Y7QUFFQSx3QkFBd0I7QUFDeEIsSUFBSTJELGFBQXlCO0FBRXRCLGVBQWVDO0lBQ3BCLElBQUksQ0FBQ3JFLFVBQVU7UUFDYixNQUFNLElBQUlhLE1BQU07SUFDbEI7SUFFQSxJQUFJLENBQUN1RCxZQUFZO1FBQ2ZBLGFBQWEsTUFBTXhEO0lBQ3JCO0lBQ0EsT0FBT3dEO0FBQ1Q7QUFFQSw0QkFBNEI7QUFDckIsZUFBZUU7SUFDcEIsSUFBSSxDQUFDdEUsVUFBVTtRQUNiLE1BQU0sSUFBSWEsTUFBTTtJQUNsQjtJQUVBLElBQUl1RCxZQUFZO1FBQ2QsTUFBTUEsV0FBV0csS0FBSztRQUN0QkgsYUFBYTtJQUNmO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly92aXRlLXJlYWN0LXR5cGVzY3JpcHQtc3RhcnRlci8uL3NyYy9saWIvZGIudHM/OWU0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDaGVjayBpZiB3ZSdyZSBydW5uaW5nIG9uIHRoZSBzZXJ2ZXIgdG8gYXZvaWQgZXJyb3JzIGluIHRoZSBicm93c2VyXG5jb25zdCBpc1NlcnZlciA9IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnO1xuXG4vLyBUeXBlIGZvciBkYXRhYmFzZSBpbnN0YW5jZVxudHlwZSBEQkluc3RhbmNlID0gYW55O1xuXG4vLyBDaGVjayBpZiBkYXRhYmFzZSBmaWxlIGV4aXN0c1xuY29uc3QgZG9lc0RCRmlsZUV4aXN0ID0gYXN5bmMgKCkgPT4ge1xuICBpZiAoIWlzU2VydmVyKSByZXR1cm4gZmFsc2U7XG4gIFxuICB0cnkge1xuICAgIGNvbnN0IGZzID0gYXdhaXQgaW1wb3J0KCdmcycpO1xuICAgIGNvbnN0IHBhdGggPSBhd2FpdCBpbXBvcnQoJ3BhdGgnKTtcbiAgICBjb25zdCBkYlBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEuZGInKTtcbiAgICByZXR1cm4gZnMuZXhpc3RzU3luYyhkYlBhdGgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIGlmIERCIGZpbGUgZXhpc3RzOicsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8vIFRyYWNrIGlmIHRoaXMgaXMgdGhlIGZpcnN0IHRpbWUgaW5pdGlhbGl6aW5nXG5sZXQgaXNGaXJzdEluaXRpYWxpemF0aW9uID0gdHJ1ZTtcblxuLy8gSW5pdGlhbGl6ZSBkYXRhYmFzZVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVEQigpIHtcbiAgaWYgKCFpc1NlcnZlcikge1xuICAgIHRocm93IG5ldyBFcnJvcignRGF0YWJhc2Ugb3BlcmF0aW9ucyBjYW4gb25seSBiZSBwZXJmb3JtZWQgb24gdGhlIHNlcnZlcicpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIHRoZSBmaXJzdCB0aW1lIHJ1bm5pbmcgb3IgaWYgdGhlIGZpbGUgZXhpc3RzXG4gICAgY29uc3QgZGJGaWxlRXhpc3RlZCA9IGF3YWl0IGRvZXNEQkZpbGVFeGlzdCgpO1xuICAgIFxuICAgIC8vIER5bmFtaWMgaW1wb3J0cyB0byBhdm9pZCBpc3N1ZXMgd2l0aCBjbGllbnQtc2lkZSBjb2RlXG4gICAgY29uc3QgeyBvcGVuIH0gPSBhd2FpdCBpbXBvcnQoJ3NxbGl0ZScpO1xuICAgIGNvbnN0IHNxbGl0ZTMgPSBhd2FpdCBpbXBvcnQoJ3NxbGl0ZTMnKTtcbiAgICBjb25zdCBiY3J5cHQgPSBhd2FpdCBpbXBvcnQoJ2JjcnlwdGpzJyk7XG4gICAgY29uc3QgcGF0aCA9IGF3YWl0IGltcG9ydCgncGF0aCcpO1xuICAgIGNvbnN0IHVybCA9IGF3YWl0IGltcG9ydCgndXJsJyk7XG4gICAgY29uc3QgZnMgPSBhd2FpdCBpbXBvcnQoJ2ZzJyk7XG5cbiAgICAvLyBTZXR1cCBwYXRoc1xuICAgIGNvbnN0IF9fZmlsZW5hbWUgPSB1cmwuZmlsZVVSTFRvUGF0aChpbXBvcnQubWV0YS51cmwpO1xuICAgIGNvbnN0IF9fZGlybmFtZSA9IHBhdGguZGlybmFtZShfX2ZpbGVuYW1lKTtcbiAgICBjb25zdCBEQl9QQVRIID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdkYXRhLmRiJyk7XG5cbiAgICBjb25zb2xlLmxvZygnSW5pdGlhbGl6aW5nIGRhdGFiYXNlIGF0OicsIERCX1BBVEgpO1xuICAgIFxuICAgIGNvbnN0IGRiID0gYXdhaXQgb3Blbih7XG4gICAgICBmaWxlbmFtZTogREJfUEFUSCxcbiAgICAgIGRyaXZlcjogc3FsaXRlMy5kZWZhdWx0LkRhdGFiYXNlXG4gICAgfSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCB0byBkYXRhYmFzZScpO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0YWJsZXMgaWYgdGhleSBkb24ndCBleGlzdFxuICAgIGF3YWl0IGRiLmV4ZWMoYFxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcnMgKFxuICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgICAgIHVzZXJuYW1lIFRFWFQgVU5JUVVFIE5PVCBOVUxMLFxuICAgICAgICBwYXNzd29yZCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBjcmVhdGVkX2F0IERBVEVUSU1FIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVBcbiAgICAgICk7XG5cbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNhdGVnb3JpZXMgKFxuICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgICAgIG5hbWUgVEVYVCBVTklRVUUgTk9UIE5VTEwsXG4gICAgICAgIGRlc2NyaXB0aW9uIFRFWFQsXG4gICAgICAgIGNyZWF0ZWRfYXQgREFURVRJTUUgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgKTtcblxuICAgICAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcHJvZHVjdHMgKFxuICAgICAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgICAgIG5hbWUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZGVzY3JpcHRpb24gVEVYVCxcbiAgICAgICAgaW1hZ2UgVEVYVCxcbiAgICAgICAgc3BlY3MgVEVYVCxcbiAgICAgICAgdXNlQ2FzZXMgVEVYVCxcbiAgICAgICAgY2F0ZWdvcnkgVEVYVCxcbiAgICAgICAgaW1hZ2VzIFRFWFQsXG4gICAgICAgIGRvY3VtZW50IFRFWFQsXG4gICAgICAgIGNyZWF0ZWRfYXQgREFURVRJTUUgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUCxcbiAgICAgICAgRk9SRUlHTiBLRVkgKGNhdGVnb3J5KSBSRUZFUkVOQ0VTIGNhdGVnb3JpZXMobmFtZSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGpvYl9vcGVuaW5ncyAoXG4gICAgICAgIGlkIElOVEVHRVIgUFJJTUFSWSBLRVkgQVVUT0lOQ1JFTUVOVCxcbiAgICAgICAgdGl0bGUgVEVYVCBOT1QgTlVMTCxcbiAgICAgICAgZGVwYXJ0bWVudCBURVhUIE5PVCBOVUxMLFxuICAgICAgICBsb2NhdGlvbiBURVhUIE5PVCBOVUxMLFxuICAgICAgICB0eXBlIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGRlc2NyaXB0aW9uIFRFWFQgTk9UIE5VTEwsXG4gICAgICAgIGNyZWF0ZWRfYXQgREFURVRJTUUgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUCxcbiAgICAgICAgYWN0aXZlIElOVEVHRVIgREVGQVVMVCAxXG4gICAgICApO1xuICAgIGApO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdEYXRhYmFzZSB0YWJsZXMgY3JlYXRlZCcpO1xuXG4gICAgLy8gQWx0ZXIgZXhpc3RpbmcgcHJvZHVjdHMgdGFibGUgdG8gYWRkIGRvY3VtZW50IGNvbHVtbiBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHRoZSBkb2N1bWVudCBjb2x1bW4gZXhpc3RzXG4gICAgICBjb25zdCB0YWJsZUluZm8gPSBhd2FpdCBkYi5hbGwoJ1BSQUdNQSB0YWJsZV9pbmZvKHByb2R1Y3RzKScpO1xuICAgICAgY29uc3QgZG9jdW1lbnRDb2x1bW5FeGlzdHMgPSB0YWJsZUluZm8uc29tZSgoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5uYW1lID09PSAnZG9jdW1lbnQnKTtcbiAgICAgIFxuICAgICAgaWYgKCFkb2N1bWVudENvbHVtbkV4aXN0cykge1xuICAgICAgICAvLyBBZGQgZG9jdW1lbnQgY29sdW1uIHRvIHByb2R1Y3RzIHRhYmxlXG4gICAgICAgIGF3YWl0IGRiLmV4ZWMoJ0FMVEVSIFRBQkxFIHByb2R1Y3RzIEFERCBDT0xVTU4gZG9jdW1lbnQgVEVYVCcpO1xuICAgICAgICBjb25zb2xlLmxvZygnQWRkZWQgZG9jdW1lbnQgY29sdW1uIHRvIHByb2R1Y3RzIHRhYmxlJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFsdGVyaW5nIHByb2R1Y3RzIHRhYmxlOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBhZG1pbiB1c2VyIGV4aXN0cywgaWYgbm90IGNyZWF0ZSBpdFxuICAgIGNvbnN0IGFkbWluVXNlciA9IGF3YWl0IGRiLmdldCgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSB1c2VybmFtZSA9ID8nLCBbJ2FkbWluJ10pO1xuICAgIFxuICAgIGlmICghYWRtaW5Vc2VyKSB7XG4gICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKCdBemVyYmF5Y2FuMTIzJywgMTApO1xuICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAnSU5TRVJUIElOVE8gdXNlcnMgKHVzZXJuYW1lLCBwYXNzd29yZCkgVkFMVUVTICg/LCA/KScsXG4gICAgICAgIFsnYWRtaW4nLCBoYXNoZWRQYXNzd29yZF1cbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZygnQWRtaW4gdXNlciBjcmVhdGVkJyk7XG4gICAgfVxuXG4gICAgLy8gSW5pdGlhbGl6ZSBkZWZhdWx0IGNhdGVnb3JpZXMgaWYgbm9uZSBleGlzdFxuICAgIGNvbnN0IGNhdGVnb3JpZXNDb3VudCA9IGF3YWl0IGRiLmdldCgnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gY2F0ZWdvcmllcycpO1xuICAgIGlmIChjYXRlZ29yaWVzQ291bnQuY291bnQgPT09IDApIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRDYXRlZ29yaWVzID0gW1xuICAgICAgICB7IG5hbWU6ICdJbmR1c3RyaWFsIEVxdWlwbWVudCcsIGRlc2NyaXB0aW9uOiAnSGVhdnktZHV0eSBpbmR1c3RyaWFsIG1hY2hpbmVyeSBhbmQgZXF1aXBtZW50JyB9LFxuICAgICAgICB7IG5hbWU6ICdTYWZldHkgR2VhcicsIGRlc2NyaXB0aW9uOiAnUGVyc29uYWwgcHJvdGVjdGl2ZSBlcXVpcG1lbnQgYW5kIHNhZmV0eSBzb2x1dGlvbnMnIH0sXG4gICAgICAgIHsgbmFtZTogJ01lYXN1cmVtZW50IFRvb2xzJywgZGVzY3JpcHRpb246ICdQcmVjaXNpb24gbWVhc3VyZW1lbnQgYW5kIHRlc3RpbmcgaW5zdHJ1bWVudHMnIH0sXG4gICAgICAgIHsgbmFtZTogJ0ZsdWlkIENvbnRyb2wnLCBkZXNjcmlwdGlvbjogJ1ZhbHZlcywgcHVtcHMsIGFuZCBmbHVpZCBtYW5hZ2VtZW50IHN5c3RlbXMnIH0sXG4gICAgICAgIHsgbmFtZTogJ1Bvd2VyIFN5c3RlbXMnLCBkZXNjcmlwdGlvbjogJ1Bvd2VyIGdlbmVyYXRpb24gYW5kIGVsZWN0cmljYWwgZXF1aXBtZW50JyB9LFxuICAgICAgICB7IG5hbWU6ICdDb25zdHJ1Y3Rpb24gRXF1aXBtZW50JywgZGVzY3JpcHRpb246ICdUb29scyBhbmQgZXF1aXBtZW50IGZvciBjb25zdHJ1Y3Rpb24gcHJvamVjdHMnIH1cbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgZGVmYXVsdENhdGVnb3JpZXMpIHtcbiAgICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAgICdJTlNFUlQgSU5UTyBjYXRlZ29yaWVzIChuYW1lLCBkZXNjcmlwdGlvbikgVkFMVUVTICg/LCA/KScsXG4gICAgICAgICAgW2NhdGVnb3J5Lm5hbWUsIGNhdGVnb3J5LmRlc2NyaXB0aW9uXVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE9ubHkgaW1wb3J0IGluaXRpYWwgcHJvZHVjdHMgaWYgdGhpcyBpcyBhIGJyYW5kIG5ldyBkYXRhYmFzZSAoZmlsZSBkaWRuJ3QgZXhpc3QgYmVmb3JlKVxuICAgIC8vIGFuZCB0aGUgcHJvZHVjdHMgdGFibGUgaXMgZW1wdHlcbiAgICBjb25zdCBwcm9kdWN0c0NvdW50ID0gYXdhaXQgZGIuZ2V0KCdTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBwcm9kdWN0cycpO1xuICAgIFxuICAgIGlmIChwcm9kdWN0c0NvdW50LmNvdW50ID09PSAwICYmICFkYkZpbGVFeGlzdGVkICYmIGlzRmlyc3RJbml0aWFsaXphdGlvbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVHJ5IHRvIGxvYWQgcHJvZHVjdHMgZnJvbSBKU09OIGZpbGVcbiAgICAgICAgY29uc3QgZnMgPSBhd2FpdCBpbXBvcnQoJ2ZzJyk7XG4gICAgICAgIGNvbnN0IHBhdGggPSBhd2FpdCBpbXBvcnQoJ3BhdGgnKTtcbiAgICAgICAgY29uc3QgcHJvZHVjdHNKc29uUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnc3JjJywgJ2RhdGEnLCAncHJvZHVjdHMuanNvbicpO1xuICAgICAgICBcbiAgICAgICAgbGV0IHByb2R1Y3RzID0gW107XG4gICAgICAgIFxuICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhwcm9kdWN0c0pzb25QYXRoKSkge1xuICAgICAgICAgIC8vIFJlYWQgSlNPTiBmaWxlXG4gICAgICAgICAgY29uc3QgcHJvZHVjdHNKc29uID0gZnMucmVhZEZpbGVTeW5jKHByb2R1Y3RzSnNvblBhdGgsICd1dGY4Jyk7XG4gICAgICAgICAgcHJvZHVjdHMgPSBKU09OLnBhcnNlKHByb2R1Y3RzSnNvbik7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0xvYWRlZCBwcm9kdWN0cyBmcm9tIEpTT04gZmlsZScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIGRlZmF1bHQgcHJvZHVjdFxuICAgICAgICAgIHByb2R1Y3RzID0gW3tcbiAgICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgICAgbmFtZTogXCJTYW1wbGUgUHJvZHVjdFwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IFwiQSBzYW1wbGUgcHJvZHVjdCBjcmVhdGVkIGF1dG9tYXRpY2FsbHlcIixcbiAgICAgICAgICAgIGltYWdlOiBcImh0dHBzOi8vcGxhY2Vob2xkLmNvLzYwMHg0MDA/dGV4dD1TYW1wbGUrUHJvZHVjdFwiLFxuICAgICAgICAgICAgc3BlY3M6IFtcIlNhbXBsZSBzcGVjaWZpY2F0aW9uIDFcIiwgXCJTYW1wbGUgc3BlY2lmaWNhdGlvbiAyXCJdLFxuICAgICAgICAgICAgdXNlQ2FzZXM6IFtcIlNhbXBsZSB1c2UgY2FzZSAxXCIsIFwiU2FtcGxlIHVzZSBjYXNlIDJcIl0sXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJTYW1wbGUgQ2F0ZWdvcnlcIlxuICAgICAgICAgIH1dO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdVc2luZyBkZWZhdWx0IHByb2R1Y3QgYXMgZmFsbGJhY2snKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSW5zZXJ0IHByb2R1Y3RzXG4gICAgICAgIGZvciAoY29uc3QgcHJvZHVjdCBvZiBwcm9kdWN0cykge1xuICAgICAgICAgIGF3YWl0IGRiLnJ1bihcbiAgICAgICAgICAgICdJTlNFUlQgSU5UTyBwcm9kdWN0cyAoaWQsIG5hbWUsIGRlc2NyaXB0aW9uLCBpbWFnZSwgc3BlY3MsIHVzZUNhc2VzLCBjYXRlZ29yeSkgVkFMVUVTICg/LCA/LCA/LCA/LCA/LCA/LCA/KScsXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgIHByb2R1Y3QuaWQsXG4gICAgICAgICAgICAgIHByb2R1Y3QubmFtZSxcbiAgICAgICAgICAgICAgcHJvZHVjdC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgcHJvZHVjdC5pbWFnZSxcbiAgICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkocHJvZHVjdC5zcGVjcyksXG4gICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHByb2R1Y3QudXNlQ2FzZXMpLFxuICAgICAgICAgICAgICBwcm9kdWN0LmNhdGVnb3J5XG4gICAgICAgICAgICBdXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhgJHtwcm9kdWN0cy5sZW5ndGh9IHByb2R1Y3RzIGluc2VydGVkIGludG8gZGF0YWJhc2VgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGltcG9ydGluZyBpbml0aWFsIHByb2R1Y3RzOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gTWFyayB0aGF0IHdlJ3ZlIGFscmVhZHkgaW5pdGlhbGl6ZWQgb25jZVxuICAgIGlzRmlyc3RJbml0aWFsaXphdGlvbiA9IGZhbHNlO1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBkZWZhdWx0IGpvYiBvcGVuaW5ncyBpZiBub25lIGV4aXN0XG4gICAgY29uc3Qgam9iT3BlbmluZ3NDb3VudCA9IGF3YWl0IGRiLmdldCgnU0VMRUNUIENPVU5UKCopIGFzIGNvdW50IEZST00gam9iX29wZW5pbmdzJyk7XG4gICAgaWYgKGpvYk9wZW5pbmdzQ291bnQuY291bnQgPT09IDApIHtcbiAgICAgIGNvbnN0IGRlZmF1bHRKb2JzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IFwiU3VwcGx5IENoYWluIE1hbmFnZXJcIixcbiAgICAgICAgICBkZXBhcnRtZW50OiBcIm9wZXJhdGlvbnNcIixcbiAgICAgICAgICBsb2NhdGlvbjogXCJCYWt1LCBBemVyYmFpamFuXCIsXG4gICAgICAgICAgdHlwZTogXCJGdWxsLXRpbWVcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJMZWFkaW5nIGFuZCBvcHRpbWl6aW5nIHN1cHBseSBjaGFpbiBvcGVyYXRpb25zLi4uXCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBcIlNhbGVzIFJlcHJlc2VudGF0aXZlXCIsXG4gICAgICAgICAgZGVwYXJ0bWVudDogXCJzYWxlc1wiLFxuICAgICAgICAgIGxvY2F0aW9uOiBcIkJha3UsIEF6ZXJiYWlqYW5cIixcbiAgICAgICAgICB0eXBlOiBcIkZ1bGwtdGltZVwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkRldmVsb3BpbmcgYW5kIG1haW50YWluaW5nIGNsaWVudCByZWxhdGlvbnNoaXBzLi4uXCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiBcIkxvZ2lzdGljcyBDb29yZGluYXRvclwiLFxuICAgICAgICAgIGRlcGFydG1lbnQ6IFwibG9naXN0aWNzXCIsXG4gICAgICAgICAgbG9jYXRpb246IFwiQmFrdSwgQXplcmJhaWphblwiLFxuICAgICAgICAgIHR5cGU6IFwiRnVsbC10aW1lXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiQ29vcmRpbmF0aW5nIHNoaXBtZW50IHNjaGVkdWxlcyBhbmQgZGVsaXZlcnkgcm91dGVzLi4uXCJcbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBqb2Igb2YgZGVmYXVsdEpvYnMpIHtcbiAgICAgICAgYXdhaXQgZGIucnVuKFxuICAgICAgICAgICdJTlNFUlQgSU5UTyBqb2Jfb3BlbmluZ3MgKHRpdGxlLCBkZXBhcnRtZW50LCBsb2NhdGlvbiwgdHlwZSwgZGVzY3JpcHRpb24pIFZBTFVFUyAoPywgPywgPywgPywgPyknLFxuICAgICAgICAgIFtqb2IudGl0bGUsIGpvYi5kZXBhcnRtZW50LCBqb2IubG9jYXRpb24sIGpvYi50eXBlLCBqb2IuZGVzY3JpcHRpb25dXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZygnRGVmYXVsdCBqb2Igb3BlbmluZ3MgY3JlYXRlZCcpO1xuICAgIH1cblxuICAgIC8vIFN0b3JlIHRoZSBkYiBpbnN0YW5jZSBpbiBtb2R1bGUgc3RhdGVcbiAgICBkYkluc3RhbmNlID0gZGI7XG4gICAgcmV0dXJuIGRiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0RhdGFiYXNlIGluaXRpYWxpemF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vLyBHZXQgZGF0YWJhc2UgaW5zdGFuY2VcbmxldCBkYkluc3RhbmNlOiBEQkluc3RhbmNlID0gbnVsbDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldERCKCkge1xuICBpZiAoIWlzU2VydmVyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdEYXRhYmFzZSBvcGVyYXRpb25zIGNhbiBvbmx5IGJlIHBlcmZvcm1lZCBvbiB0aGUgc2VydmVyJyk7XG4gIH1cbiAgXG4gIGlmICghZGJJbnN0YW5jZSkge1xuICAgIGRiSW5zdGFuY2UgPSBhd2FpdCBpbml0aWFsaXplREIoKTtcbiAgfVxuICByZXR1cm4gZGJJbnN0YW5jZTtcbn1cblxuLy8gQ2xvc2UgZGF0YWJhc2UgY29ubmVjdGlvblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsb3NlREIoKSB7XG4gIGlmICghaXNTZXJ2ZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0RhdGFiYXNlIG9wZXJhdGlvbnMgY2FuIG9ubHkgYmUgcGVyZm9ybWVkIG9uIHRoZSBzZXJ2ZXInKTtcbiAgfVxuICBcbiAgaWYgKGRiSW5zdGFuY2UpIHtcbiAgICBhd2FpdCBkYkluc3RhbmNlLmNsb3NlKCk7XG4gICAgZGJJbnN0YW5jZSA9IG51bGw7XG4gIH1cbn0gIl0sIm5hbWVzIjpbImlzU2VydmVyIiwiZG9lc0RCRmlsZUV4aXN0IiwiZnMiLCJwYXRoIiwiZGJQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJleGlzdHNTeW5jIiwiZXJyb3IiLCJjb25zb2xlIiwiaXNGaXJzdEluaXRpYWxpemF0aW9uIiwiaW5pdGlhbGl6ZURCIiwiRXJyb3IiLCJkYkZpbGVFeGlzdGVkIiwib3BlbiIsInNxbGl0ZTMiLCJiY3J5cHQiLCJ1cmwiLCJfX2ZpbGVuYW1lIiwiZmlsZVVSTFRvUGF0aCIsIl9fZGlybmFtZSIsImRpcm5hbWUiLCJEQl9QQVRIIiwibG9nIiwiZGIiLCJmaWxlbmFtZSIsImRyaXZlciIsImRlZmF1bHQiLCJEYXRhYmFzZSIsImV4ZWMiLCJ0YWJsZUluZm8iLCJhbGwiLCJkb2N1bWVudENvbHVtbkV4aXN0cyIsInNvbWUiLCJjb2x1bW4iLCJuYW1lIiwiYWRtaW5Vc2VyIiwiZ2V0IiwiaGFzaGVkUGFzc3dvcmQiLCJoYXNoIiwicnVuIiwiY2F0ZWdvcmllc0NvdW50IiwiY291bnQiLCJkZWZhdWx0Q2F0ZWdvcmllcyIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcnkiLCJwcm9kdWN0c0NvdW50IiwicHJvZHVjdHNKc29uUGF0aCIsInByb2R1Y3RzIiwicHJvZHVjdHNKc29uIiwicmVhZEZpbGVTeW5jIiwiSlNPTiIsInBhcnNlIiwiaWQiLCJpbWFnZSIsInNwZWNzIiwidXNlQ2FzZXMiLCJwcm9kdWN0Iiwic3RyaW5naWZ5IiwibGVuZ3RoIiwiam9iT3BlbmluZ3NDb3VudCIsImRlZmF1bHRKb2JzIiwidGl0bGUiLCJkZXBhcnRtZW50IiwibG9jYXRpb24iLCJ0eXBlIiwiam9iIiwiZGJJbnN0YW5jZSIsImdldERCIiwiY2xvc2VEQiIsImNsb3NlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/db.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fproducts&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fproducts.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();